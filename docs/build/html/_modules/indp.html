

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="Python 3.7.6" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="Python 3.7.6" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>indp &mdash; Decenalized Decision Making 0.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Decenalized Decision Making
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Topics:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../main_vars.html">Input Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../run_main.html">Run INDP and Judgment Call</a></li>
<li class="toctree-l1"><a class="reference internal" href="../indp_main.html">Interdependent Network Design Problem (INDP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dindp_main.html">Judgment Call Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gameclasses.html">Restoration Game Classes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Decenalized Decision Making</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>indp</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for indp</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">infrastructure</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">indputils</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">gurobipy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="c1">#import platform</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="c1">#import copy</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="c1">#HOME_DIR=&quot;/Users/Andrew/&quot;</span>
<span class="c1">#if platform.system() == &quot;Linux&quot;:</span>
<span class="c1">#    HOME_DIR=&quot;/home/andrew/&quot;</span>

<div class="viewcode-block" id="indp"><a class="viewcode-back" href="../indp.html#indp.indp">[docs]</a><span class="k">def</span> <span class="nf">indp</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">v_r</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">layers</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="n">controlled_layers</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="n">functionality</span><span class="o">=</span><span class="p">{},</span>
         <span class="n">forced_actions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fixed_nodes</span><span class="o">=</span><span class="p">{},</span> <span class="n">print_cmd</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">time_limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;INDP optimization problem. Also solves td-INDP if T &gt; 1.</span>
<span class="sd">    :param N: An InfrastructureNetwork instance (created in infrastructure.py)</span>
<span class="sd">    :param v_r: Vector of number of resources given to each layer in each timestep. If the size of the vector is 1, it shows the total number of resources for all layers.</span>
<span class="sd">    :param T: Number of timesteps to optimize over.</span>
<span class="sd">    :param layers: Layer IDs of N included in the optimization. (Default is water (1) and power (3)).</span>
<span class="sd">    :param controlled_layers: Layer IDs that can be recovered in this optimization. Used for decentralized optimization.</span>
<span class="sd">    :param functionality: Dictionary of nodes to functionality values for non-controlled nodes. Used for decentralized optimization.</span>
<span class="sd">    :returns: A list of the form [actions,costs] for a successful optimization.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#print &quot;T=&quot;,T</span>
    <span class="c1">#if functionality:</span>
    <span class="c1">#    for t in functionality:</span>
    <span class="c1">#        for u in functionality[t]:</span>
    <span class="c1">#            if functionality[t][u] == 0.0:</span>
    <span class="c1">#                print &quot;At Time&quot;,str(t),&quot;, node&quot;,u,&quot;is broken.&quot;</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">m</span><span class="o">=</span><span class="n">Model</span><span class="p">(</span><span class="s1">&#39;indp&#39;</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s1">&#39;OutputFlag&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">time_limit</span><span class="p">:</span>
        <span class="n">m</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s1">&#39;TimeLimit&#39;</span><span class="p">,</span> <span class="n">time_limit</span><span class="p">)</span>
    <span class="n">G_prime_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">N</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">net_id</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">]</span>
    <span class="n">G_prime</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">G_prime_nodes</span><span class="p">)</span>
    <span class="c1"># Damaged nodes in whole network</span>
    <span class="n">N_prime</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">G_prime</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">repaired</span><span class="o">==</span><span class="mf">0.0</span><span class="p">]</span>
    <span class="c1"># Nodes in controlled network.</span>
    <span class="n">N_hat_nodes</span>   <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">G_prime</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">net_id</span> <span class="ow">in</span> <span class="n">controlled_layers</span><span class="p">]</span>
    <span class="n">N_hat</span> <span class="o">=</span> <span class="n">G_prime</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">N_hat_nodes</span><span class="p">)</span>
    <span class="c1"># Damaged nodes in controlled network.</span>
    <span class="n">N_hat_prime</span><span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">N_hat</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">repaired</span><span class="o">==</span><span class="mf">0.0</span><span class="p">]</span>
    <span class="c1"># Damaged arcs in whole network</span>
    <span class="n">A_prime</span> <span class="o">=</span> <span class="p">[(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">G_prime</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="o">==</span><span class="mf">0.0</span><span class="p">]</span>
    <span class="c1"># Damaged arcs in controlled network.</span>
    <span class="n">A_hat_prime</span> <span class="o">=</span> <span class="p">[(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">A_prime</span> <span class="k">if</span> <span class="n">N_hat</span><span class="o">.</span><span class="n">has_node</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="ow">and</span> <span class="n">N_hat</span><span class="o">.</span><span class="n">has_node</span><span class="p">(</span><span class="n">v</span><span class="p">)]</span>
    <span class="c1">#print &quot;A_hat_prime=&quot;,A_hat_prime</span>
    <span class="n">S</span><span class="o">=</span><span class="n">N</span><span class="o">.</span><span class="n">S</span>
    <span class="c1">#print &quot;&quot;</span>
    <span class="c1">#print &quot;New sim.&quot;</span>
    <span class="c1"># Populate interdepencies. Add nodes to N&#39; if they currently rely on a non-functional node.</span>
    <span class="n">interdep_nodes</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">G_prime</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">functionality</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_interdep</span> <span class="ow">and</span> <span class="n">G_prime</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="c1">#print &quot;Dependency edge goes from:&quot;,u,&quot;to&quot;,v</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">interdep_nodes</span><span class="p">:</span>
                    <span class="n">interdep_nodes</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
                <span class="n">interdep_nodes</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">u</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">gamma</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Should populate N_hat with layers that are controlled. Then go through N_hat.edges(data=True)</span>
            <span class="c1"># to find interdependencies.</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">t</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">interdep_nodes</span><span class="p">:</span>
                    <span class="n">interdep_nodes</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
                <span class="k">if</span> <span class="n">N_hat</span><span class="o">.</span><span class="n">has_node</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">and</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_interdep</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">functionality</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">u</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">interdep_nodes</span><span class="p">[</span><span class="n">t</span><span class="p">]:</span>
                            <span class="n">interdep_nodes</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">v</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
                        <span class="n">interdep_nodes</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">u</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">gamma</span><span class="p">))</span>

    <span class="c1">#print &quot;N&#39;=&quot;,[n for (n,d) in N_prime]</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
        <span class="c1"># Add geographical space variables.</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">S</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;z_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">BINARY</span><span class="p">)</span>
        <span class="c1"># Add over/undersupply variables for each node.</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="n">N_hat</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">m</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;delta+_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="n">lb</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;delta-_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="n">lb</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="c1"># Add functionality binary variables for each node in N&#39;.</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="n">N_hat</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">m</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;w_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">BINARY</span><span class="p">)</span>               
            <span class="k">if</span> <span class="n">T</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;w_tilde_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">BINARY</span><span class="p">)</span> 
        <span class="c1"># Fix node values (only for iINDP)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">fixed_nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;w_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">lb</span><span class="o">=</span><span class="n">val</span>
            <span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;w_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">ub</span><span class="o">=</span><span class="n">val</span>                   
        <span class="c1"># Add flow variables for each arc.</span>
        <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">N_hat</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">m</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;x_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="n">lb</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="c1"># Add functionality binary variables for each arc in A&#39;.</span>
        <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">A_hat_prime</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;y_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">BINARY</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">T</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;y_tilde_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">BINARY</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="c1"># Populate objective function.</span>
    <span class="n">objFunc</span><span class="o">=</span><span class="n">LinExpr</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">S</span><span class="p">:</span>
            <span class="n">objFunc</span><span class="o">+=</span><span class="n">s</span><span class="o">.</span><span class="n">cost</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;z_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">A_hat_prime</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">T</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">objFunc</span><span class="o">+=</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reconstruction_cost</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;y_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">objFunc</span><span class="o">+=</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reconstruction_cost</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;y_tilde_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="n">N_hat_prime</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">T</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">objFunc</span><span class="o">+=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reconstruction_cost</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;w_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">objFunc</span><span class="o">+=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reconstruction_cost</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;w_tilde_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="n">N_hat</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">objFunc</span><span class="o">+=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">oversupply_penalty</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;delta+_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
            <span class="n">objFunc</span><span class="o">+=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">undersupply_penalty</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;delta-_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">N_hat</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">objFunc</span><span class="o">+=</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flow_cost</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;x_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>


    <span class="n">m</span><span class="o">.</span><span class="n">setObjective</span><span class="p">(</span><span class="n">objFunc</span><span class="p">,</span><span class="n">GRB</span><span class="o">.</span><span class="n">MINIMIZE</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="c1">#Constraints.</span>
    <span class="c1"># Time-dependent constraints.</span>
    <span class="k">if</span> <span class="n">T</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="n">N_hat</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;w_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,0&quot;</span><span class="p">),</span><span class="n">GRB</span><span class="o">.</span><span class="n">EQUAL</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">A_hat_prime</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;y_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,0&quot;</span><span class="p">),</span><span class="n">GRB</span><span class="o">.</span><span class="n">EQUAL</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>


    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
        <span class="c1"># Time-dependent constraint.</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="n">N_hat</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">wTildeSum</span><span class="o">=</span><span class="n">LinExpr</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">t_prime</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
                    <span class="n">wTildeSum</span><span class="o">+=</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;w_tilde_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t_prime</span><span class="p">))</span>
                <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;w_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span><span class="n">GRB</span><span class="o">.</span><span class="n">LESS_EQUAL</span><span class="p">,</span><span class="n">wTildeSum</span><span class="p">,</span><span class="s2">&quot;Time dependent recovery constraint at node &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">A_hat_prime</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">yTildeSum</span><span class="o">=</span><span class="n">LinExpr</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">t_prime</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
                    <span class="n">yTildeSum</span><span class="o">+=</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;y_tilde_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t_prime</span><span class="p">))</span>
                <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;y_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span><span class="n">GRB</span><span class="o">.</span><span class="n">LESS_EQUAL</span><span class="p">,</span><span class="n">yTildeSum</span><span class="p">,</span><span class="s2">&quot;Time dependent recovery constraint at arc &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="c1"># Enforce a_i,j to be fixed if a_j,i is fixed (and vice versa).</span>
        <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">A_hat_prime</span><span class="p">:</span>
            <span class="c1">#print u,&quot;,&quot;,v</span>
            <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;y_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span><span class="n">GRB</span><span class="o">.</span><span class="n">EQUAL</span><span class="p">,</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;y_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span><span class="s2">&quot;Arc reconstruction equality (&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">T</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;y_tilde_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span><span class="n">GRB</span><span class="o">.</span><span class="n">EQUAL</span><span class="p">,</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;y_tilde_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span><span class="s2">&quot;Arc reconstruction equality (&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
        <span class="c1"># Conservation of flow constraint. (2) in INDP paper.</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="n">N_hat</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">outFlowConstr</span><span class="o">=</span><span class="n">LinExpr</span><span class="p">()</span>
            <span class="n">inFlowConstr</span><span class="o">=</span> <span class="n">LinExpr</span><span class="p">()</span>
            <span class="n">demandConstr</span><span class="o">=</span> <span class="n">LinExpr</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">N_hat</span><span class="o">.</span><span class="n">out_edges</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="n">outFlowConstr</span><span class="o">+=</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;x_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">N_hat</span><span class="o">.</span><span class="n">in_edges</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="n">inFlowConstr</span><span class="o">+=</span> <span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;x_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
            <span class="n">demandConstr</span><span class="o">+=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">demand</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;delta+_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;delta-_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
            <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">outFlowConstr</span><span class="o">-</span><span class="n">inFlowConstr</span><span class="p">,</span><span class="n">GRB</span><span class="o">.</span><span class="n">EQUAL</span><span class="p">,</span><span class="n">demandConstr</span><span class="p">,</span><span class="s2">&quot;Flow conservation constraint &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="c1"># Flow functionality constraints.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">functionality</span><span class="p">:</span>
            <span class="n">interdep_nodes_list</span> <span class="o">=</span> <span class="n">interdep_nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="c1">#Interdepndent nodes with a damaged dependee node</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">interdep_nodes_list</span> <span class="o">=</span> <span class="n">interdep_nodes</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="c1">#Interdepndent nodes with a damaged dependee node</span>
        <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">N_hat</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">u</span> <span class="ow">in</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="ow">in</span> <span class="n">N_hat_prime</span><span class="p">])</span> <span class="o">|</span> <span class="p">(</span><span class="n">u</span> <span class="ow">in</span> <span class="n">interdep_nodes_list</span><span class="p">):</span>
                <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;x_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span><span class="n">GRB</span><span class="o">.</span><span class="n">LESS_EQUAL</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">capacity</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;w_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span><span class="s2">&quot;Flow in functionality constraint(&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;x_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span><span class="n">GRB</span><span class="o">.</span><span class="n">LESS_EQUAL</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">capacity</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="p">,</span><span class="s2">&quot;Flow in functionality constraint (&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="ow">in</span> <span class="n">N_hat_prime</span><span class="p">])</span> <span class="o">|</span> <span class="p">(</span><span class="n">v</span> <span class="ow">in</span> <span class="n">interdep_nodes_list</span><span class="p">):</span>
                <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;x_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span><span class="n">GRB</span><span class="o">.</span><span class="n">LESS_EQUAL</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">capacity</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;w_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span><span class="s2">&quot;Flow out functionality constraint(&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;x_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span><span class="n">GRB</span><span class="o">.</span><span class="n">LESS_EQUAL</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">capacity</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="p">,</span><span class="s2">&quot;Flow out functionality constraint (&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="ow">in</span> <span class="n">A_hat_prime</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;x_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span><span class="n">GRB</span><span class="o">.</span><span class="n">LESS_EQUAL</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">capacity</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;y_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span><span class="s2">&quot;Flow arc functionality constraint (&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;x_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span><span class="n">GRB</span><span class="o">.</span><span class="n">LESS_EQUAL</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">capacity</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">v</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="p">,</span><span class="s2">&quot;Flow arc functionality constraint(&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>

        <span class="c1">#Resource availability constraints.</span>
        <span class="n">isSepResource</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v_r</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">totalResource</span> <span class="o">=</span> <span class="n">v_r</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v_r</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">isSepResource</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">totalResource</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v_r</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v_r</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">layers</span><span class="p">):</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;The number of resource cap values does not match the number of layers.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">totalResource</span> <span class="o">=</span> <span class="n">v_r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">resourceLeftConstr</span><span class="o">=</span><span class="n">LinExpr</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">isSepResource</span><span class="p">:</span>
            <span class="n">resourceLeftConstrSep</span> <span class="o">=</span> <span class="p">[</span><span class="n">LinExpr</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v_r</span><span class="p">))]</span>

        <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">A_hat_prime</span><span class="p">:</span>
            <span class="n">indexLayer</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">layer</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">T</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">resourceLeftConstr</span><span class="o">+=</span><span class="mf">0.5</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resource_usage</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;y_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">isSepResource</span><span class="p">:</span>
                    <span class="n">resourceLeftConstrSep</span><span class="p">[</span><span class="n">indexLayer</span><span class="p">]</span><span class="o">+=</span><span class="mf">0.5</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resource_usage</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;y_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">resourceLeftConstr</span><span class="o">+=</span><span class="mf">0.5</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resource_usage</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;y_tilde_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">isSepResource</span><span class="p">:</span>
                    <span class="n">resourceLeftConstrSep</span><span class="p">[</span><span class="n">indexLayer</span><span class="p">]</span><span class="o">+=</span><span class="mf">0.5</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resource_usage</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;y_tilde_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="n">N_hat_prime</span><span class="p">:</span>
            <span class="n">indexLayer</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">T</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">resourceLeftConstr</span><span class="o">+=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resource_usage</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;w_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">isSepResource</span><span class="p">:</span>
                    <span class="n">resourceLeftConstrSep</span><span class="p">[</span><span class="n">indexLayer</span><span class="p">]</span><span class="o">+=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resource_usage</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;w_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">resourceLeftConstr</span><span class="o">+=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resource_usage</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;w_tilde_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">isSepResource</span><span class="p">:</span>
                    <span class="n">resourceLeftConstrSep</span><span class="p">[</span><span class="n">indexLayer</span><span class="p">]</span><span class="o">+=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resource_usage</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;w_tilde_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>

        <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">resourceLeftConstr</span><span class="p">,</span><span class="n">GRB</span><span class="o">.</span><span class="n">LESS_EQUAL</span><span class="p">,</span><span class="n">totalResource</span><span class="p">,</span><span class="s2">&quot;Resource availability constraint at &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">isSepResource</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v_r</span><span class="p">)):</span>
                <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">resourceLeftConstrSep</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">GRB</span><span class="o">.</span><span class="n">LESS_EQUAL</span><span class="p">,</span><span class="n">v_r</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="s2">&quot;Resource availability constraint at &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; for layer &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>

        <span class="c1"># Interdependency constraints</span>
        <span class="n">infeasible_actions</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="n">N_hat</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">functionality</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">interdep_nodes</span><span class="p">:</span>
                    <span class="n">interdepLConstr</span><span class="o">=</span><span class="n">LinExpr</span><span class="p">()</span>
                    <span class="n">interdepRConstr</span><span class="o">=</span><span class="n">LinExpr</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">interdep</span> <span class="ow">in</span> <span class="n">interdep_nodes</span><span class="p">[</span><span class="n">n</span><span class="p">]:</span>
                        <span class="n">src</span><span class="o">=</span><span class="n">interdep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">gamma</span><span class="o">=</span><span class="n">interdep</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">N_hat</span><span class="o">.</span><span class="n">has_node</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
                            <span class="n">infeasible_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                            <span class="n">interdepLConstr</span><span class="o">+=</span><span class="mi">0</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">interdepLConstr</span><span class="o">+=</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;w_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">src</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">*</span><span class="n">gamma</span>
                    <span class="n">interdepRConstr</span><span class="o">+=</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;w_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
                    <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">interdepLConstr</span><span class="p">,</span><span class="n">GRB</span><span class="o">.</span><span class="n">GREATER_EQUAL</span><span class="p">,</span><span class="n">interdepRConstr</span><span class="p">,</span><span class="s2">&quot;Interdependency constraint for node &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">interdep_nodes</span><span class="p">[</span><span class="n">t</span><span class="p">]:</span>
                    <span class="c1">#print interdep_nodes[t]</span>
                    <span class="n">interdepLConstr</span><span class="o">=</span><span class="n">LinExpr</span><span class="p">()</span>
                    <span class="n">interdepRConstr</span><span class="o">=</span><span class="n">LinExpr</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">interdep</span> <span class="ow">in</span> <span class="n">interdep_nodes</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">n</span><span class="p">]:</span>
                        <span class="n">src</span><span class="o">=</span><span class="n">interdep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">gamma</span><span class="o">=</span><span class="n">interdep</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">N_hat</span><span class="o">.</span><span class="n">has_node</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">print_cmd</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Forcing&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="s2">&quot;to be 0 (dep. on&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">src</span><span class="p">),</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
                            <span class="n">infeasible_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                            <span class="n">interdepLConstr</span><span class="o">+=</span><span class="mi">0</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">interdepLConstr</span><span class="o">+=</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;w_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">src</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">*</span><span class="n">gamma</span>
                    <span class="n">interdepRConstr</span><span class="o">+=</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;w_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
                    <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">interdepLConstr</span><span class="p">,</span><span class="n">GRB</span><span class="o">.</span><span class="n">GREATER_EQUAL</span><span class="p">,</span><span class="n">interdepRConstr</span><span class="p">,</span><span class="s2">&quot;Interdependency constraint for node &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>

        <span class="c1"># Forced actions (if applicable)</span>
        <span class="k">if</span> <span class="n">forced_actions</span><span class="p">:</span>
            <span class="n">recovery_sum</span><span class="o">=</span><span class="n">LinExpr</span><span class="p">()</span>
            <span class="n">feasible_nodes</span><span class="o">=</span><span class="p">[(</span><span class="n">n</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="n">N_hat_prime</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">infeasible_actions</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">feasible_nodes</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">A_hat_prime</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="n">feasible_nodes</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">T</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">recovery_sum</span><span class="o">+=</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;w_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">recovery_sum</span><span class="o">+=</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;w_tilde_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">A_hat_prime</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">T</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">recovery_sum</span><span class="o">+=</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;y_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">recovery_sum</span><span class="o">+=</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;y_tilde_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
                <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">recovery_sum</span><span class="p">,</span><span class="n">GRB</span><span class="o">.</span><span class="n">GREATER_EQUAL</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;Forced action constraint&quot;</span><span class="p">)</span>

        <span class="c1"># Geographic space constraints</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">S</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="n">N_hat_prime</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">T</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;w_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">in_space</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">id</span><span class="p">),</span><span class="n">GRB</span><span class="o">.</span><span class="n">LESS_EQUAL</span><span class="p">,</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;z_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span><span class="s2">&quot;Geographical space constraint for node &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;w_tilde_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">in_space</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">id</span><span class="p">),</span><span class="n">GRB</span><span class="o">.</span><span class="n">LESS_EQUAL</span><span class="p">,</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;z_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span><span class="s2">&quot;Geographical space constraint for node &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">A_hat_prime</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">T</span><span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;y_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">in_space</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">id</span><span class="p">),</span><span class="n">GRB</span><span class="o">.</span><span class="n">LESS_EQUAL</span><span class="p">,</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;z_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span><span class="s2">&quot;Geographical space constraint for arc (&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">m</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;y_tilde_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">in_space</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">id</span><span class="p">),</span><span class="n">GRB</span><span class="o">.</span><span class="n">LESS_EQUAL</span><span class="p">,</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;z_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span><span class="s2">&quot;Geographical space constraint for arc (&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>

<span class="c1">#    print &quot;Solving...&quot;</span>
    <span class="n">m</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="n">m</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
    <span class="n">run_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_time</span>
    <span class="c1"># Save results.</span>
    <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">getAttr</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">)</span><span class="o">==</span><span class="n">GRB</span><span class="o">.</span><span class="n">OPTIMAL</span> <span class="ow">or</span> <span class="n">m</span><span class="o">.</span><span class="n">status</span><span class="o">==</span><span class="mi">9</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">status</span><span class="o">==</span><span class="mi">9</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Optimizer time limit, gap = </span><span class="si">%1.3f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">m</span><span class="o">.</span><span class="n">MIPGap</span><span class="p">)</span>
        <span class="n">results</span><span class="o">=</span><span class="n">collect_results</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">controlled_layers</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">N_hat</span><span class="p">,</span><span class="n">N_hat_prime</span><span class="p">,</span><span class="n">A_hat_prime</span><span class="p">,</span><span class="n">S</span><span class="p">)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">add_run_time</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">run_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="n">results</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">getAttr</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">),</span><span class="s2">&quot;: SOLUTION NOT FOUND. (Check data and/or violated constraints).&quot;</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">computeIIS</span><span class="p">()</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">The following constraint(s) cannot be satisfied:&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">getConstrs</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">IISConstr</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">c</span><span class="o">.</span><span class="n">constrName</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<span class="k">def</span> <span class="nf">collect_results</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">controlled_layers</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">N_hat</span><span class="p">,</span><span class="n">N_hat_prime</span><span class="p">,</span><span class="n">A_hat_prime</span><span class="p">,</span><span class="n">S</span><span class="p">):</span>
    <span class="n">layers</span> <span class="o">=</span> <span class="n">controlled_layers</span>
    <span class="n">indp_results</span><span class="o">=</span><span class="n">INDPResults</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span>
    <span class="c1"># compute total demand of all layers and each layer</span>
    <span class="n">total_demand</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">total_demand_layer</span><span class="o">=</span><span class="p">{</span><span class="n">l</span><span class="p">:</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="n">N_hat</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">demand_value</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">demand</span>
        <span class="k">if</span> <span class="n">demand_value</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">total_demand</span><span class="o">+=</span><span class="n">demand_value</span>
            <span class="n">total_demand_layer</span><span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">+=</span><span class="n">demand_value</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
        <span class="n">nodeCost</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">arcCost</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">flowCost</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">overSuppCost</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">underSuppCost</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">underSupp</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">spacePrepCost</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">nodeCost_layer</span><span class="o">=</span><span class="p">{</span><span class="n">l</span><span class="p">:</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">}</span>
        <span class="n">arcCost_layer</span><span class="o">=</span><span class="p">{</span><span class="n">l</span><span class="p">:</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">}</span>
        <span class="n">flowCost_layer</span><span class="o">=</span><span class="p">{</span><span class="n">l</span><span class="p">:</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">}</span>
        <span class="n">overSuppCost_layer</span><span class="o">=</span><span class="p">{</span><span class="n">l</span><span class="p">:</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">}</span>
        <span class="n">underSuppCost_layer</span><span class="o">=</span><span class="p">{</span><span class="n">l</span><span class="p">:</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">}</span>
        <span class="n">underSupp_layer</span><span class="o">=</span><span class="p">{</span><span class="n">l</span><span class="p">:</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">}</span>
        <span class="n">spacePrepCost_layer</span><span class="o">=</span><span class="p">{</span><span class="n">l</span><span class="p">:</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">}</span> <span class="c1">#!!! populate this for each layer</span>
        <span class="c1"># Record node recovery actions.</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="n">N_hat_prime</span><span class="p">:</span>
            <span class="n">nodeVar</span><span class="o">=</span><span class="s1">&#39;w_tilde_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">T</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">nodeVar</span><span class="o">=</span><span class="s1">&#39;w_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">round</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="n">nodeVar</span><span class="p">)</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">action</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">indp_results</span><span class="o">.</span><span class="n">add_action</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">action</span><span class="p">)</span>
                    <span class="c1">#if T == 1:</span>
                    <span class="c1">#N.G.node[n][&#39;data&#39;][&#39;inf_data&#39;].functionality=1.0</span>
        <span class="c1"># Record edge recovery actions.</span>
        <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">A_hat_prime</span><span class="p">:</span>
            <span class="n">arcVar</span><span class="o">=</span><span class="s1">&#39;y_tilde_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">T</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">arcVar</span><span class="o">=</span><span class="s1">&#39;y_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">round</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="n">arcVar</span><span class="p">)</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">action</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">indp_results</span><span class="o">.</span><span class="n">add_action</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">action</span><span class="p">)</span>
                <span class="c1">#if T == 1:</span>
                <span class="c1">#N.G[u][v][&#39;data&#39;][&#39;inf_data&#39;].functionality=1.0</span>
        <span class="c1"># Calculate space preparation costs.</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">S</span><span class="p">:</span>
            <span class="n">spacePrepCost</span><span class="o">+=</span><span class="n">s</span><span class="o">.</span><span class="n">cost</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;z_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">.</span><span class="n">x</span>
        <span class="n">indp_results</span><span class="o">.</span><span class="n">add_cost</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s2">&quot;Space Prep&quot;</span><span class="p">,</span><span class="n">spacePrepCost</span><span class="p">,</span><span class="n">spacePrepCost_layer</span><span class="p">)</span>
        <span class="c1"># Calculate arc preparation costs.</span>
        <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">A_hat_prime</span><span class="p">:</span>
            <span class="n">arcVar</span><span class="o">=</span><span class="s1">&#39;y_tilde_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">T</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">arcVar</span><span class="o">=</span><span class="s1">&#39;y_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="n">arcCost</span><span class="o">+=</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reconstruction_cost</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="n">arcVar</span><span class="p">)</span><span class="o">.</span><span class="n">x</span>
            <span class="n">arcCost_layer</span><span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">+=</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reconstruction_cost</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="n">arcVar</span><span class="p">)</span><span class="o">.</span><span class="n">x</span>
        <span class="n">indp_results</span><span class="o">.</span><span class="n">add_cost</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s2">&quot;Arc&quot;</span><span class="p">,</span><span class="n">arcCost</span><span class="p">,</span><span class="n">arcCost_layer</span><span class="p">)</span>
        <span class="c1"># Calculate node preparation costs.</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="n">N_hat_prime</span><span class="p">:</span>
            <span class="n">nodeVar</span> <span class="o">=</span> <span class="s1">&#39;w_tilde_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">T</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">nodeVar</span> <span class="o">=</span> <span class="s1">&#39;w_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="n">nodeCost</span><span class="o">+=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reconstruction_cost</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="n">nodeVar</span><span class="p">)</span><span class="o">.</span><span class="n">x</span>
            <span class="n">nodeCost_layer</span><span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">+=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reconstruction_cost</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="n">nodeVar</span><span class="p">)</span><span class="o">.</span><span class="n">x</span>
        <span class="n">indp_results</span><span class="o">.</span><span class="n">add_cost</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s2">&quot;Node&quot;</span><span class="p">,</span><span class="n">nodeCost</span><span class="p">,</span><span class="n">nodeCost_layer</span><span class="p">)</span>
        <span class="c1"># Calculate under/oversupply costs.</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="n">N_hat</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">overSuppCost</span><span class="o">+=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">oversupply_penalty</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;delta+_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">.</span><span class="n">x</span>
            <span class="n">overSuppCost_layer</span><span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">+=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">oversupply_penalty</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;delta+_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">.</span><span class="n">x</span>
            <span class="n">underSupp</span><span class="o">+=</span> <span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;delta+_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">.</span><span class="n">x</span>
            <span class="n">underSupp_layer</span><span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">+=</span> <span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;delta+_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">.</span><span class="n">x</span><span class="o">/</span><span class="n">total_demand_layer</span><span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">underSuppCost</span><span class="o">+=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">undersupply_penalty</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;delta-_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">.</span><span class="n">x</span>
            <span class="n">underSuppCost_layer</span><span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">+=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">undersupply_penalty</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;delta-_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">.</span><span class="n">x</span>
        <span class="n">indp_results</span><span class="o">.</span><span class="n">add_cost</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s2">&quot;Over Supply&quot;</span><span class="p">,</span><span class="n">overSuppCost</span><span class="p">,</span><span class="n">overSuppCost_layer</span><span class="p">)</span>
        <span class="n">indp_results</span><span class="o">.</span><span class="n">add_cost</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s2">&quot;Under Supply&quot;</span><span class="p">,</span><span class="n">underSuppCost</span><span class="p">,</span><span class="n">underSuppCost_layer</span><span class="p">)</span>
        <span class="n">indp_results</span><span class="o">.</span><span class="n">add_cost</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s2">&quot;Under Supply Perc&quot;</span><span class="p">,</span><span class="n">underSupp</span><span class="o">/</span><span class="n">total_demand</span><span class="p">,</span><span class="n">underSupp_layer</span><span class="p">)</span>
        <span class="c1"># Calculate flow costs.</span>
        <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">N_hat</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">flowCost</span><span class="o">+=</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flow_cost</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;x_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">.</span><span class="n">x</span>
            <span class="n">flowCost_layer</span><span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">+=</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flow_cost</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="s1">&#39;x_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">.</span><span class="n">x</span>
        <span class="n">indp_results</span><span class="o">.</span><span class="n">add_cost</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s2">&quot;Flow&quot;</span><span class="p">,</span><span class="n">flowCost</span><span class="p">,</span><span class="n">flowCost_layer</span><span class="p">)</span>
        <span class="c1"># Calculate total costs.</span>
        <span class="n">total_lyr</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">total_nd_lyr</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
            <span class="n">total_lyr</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">flowCost_layer</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">+</span><span class="n">arcCost_layer</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">+</span><span class="n">nodeCost_layer</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">+</span>\
                <span class="n">overSuppCost_layer</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">+</span><span class="n">underSuppCost_layer</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">+</span><span class="n">spacePrepCost_layer</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
            <span class="n">total_nd_lyr</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">spacePrepCost_layer</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">+</span><span class="n">arcCost_layer</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">+</span><span class="n">flowCost</span><span class="o">+</span><span class="n">nodeCost_layer</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
        <span class="n">indp_results</span><span class="o">.</span><span class="n">add_cost</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s2">&quot;Total&quot;</span><span class="p">,</span><span class="n">flowCost</span><span class="o">+</span><span class="n">arcCost</span><span class="o">+</span><span class="n">nodeCost</span><span class="o">+</span><span class="n">overSuppCost</span><span class="o">+</span>\
                              <span class="n">underSuppCost</span><span class="o">+</span><span class="n">spacePrepCost</span><span class="p">,</span><span class="n">total_lyr</span><span class="p">)</span>
        <span class="n">indp_results</span><span class="o">.</span><span class="n">add_cost</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s2">&quot;Total no disconnection&quot;</span><span class="p">,</span><span class="n">spacePrepCost</span><span class="o">+</span><span class="n">arcCost</span><span class="o">+</span>\
                              <span class="n">flowCost</span><span class="o">+</span><span class="n">nodeCost</span><span class="p">,</span><span class="n">total_nd_lyr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">indp_results</span>

<span class="k">def</span> <span class="nf">apply_recovery</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">indp_results</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">indp_results</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="s1">&#39;actions&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">action</span><span class="p">:</span>
            <span class="c1"># Edge recovery action.</span>
            <span class="n">data</span><span class="o">=</span><span class="n">action</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="n">src</span><span class="o">=</span><span class="nb">tuple</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)])</span>
            <span class="n">dst</span><span class="o">=</span><span class="nb">tuple</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)])</span>
            <span class="n">N</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">src</span><span class="p">][</span><span class="n">dst</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Node recovery action.</span>
            <span class="n">node</span><span class="o">=</span><span class="nb">tuple</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">action</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)])</span>
            <span class="c1">#print &quot;Applying recovery:&quot;,node</span>
            <span class="n">N</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">repaired</span><span class="o">=</span><span class="mf">1.0</span>
            <span class="n">N</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="mf">1.0</span>

<span class="c1">#    for u,v,a in N.G.edges(data=True):</span>
<span class="c1">#        if a[&#39;data&#39;][&#39;inf_data&#39;].is_interdep:</span>
<span class="c1">#            if N.G.node[u][&#39;data&#39;][&#39;inf_data&#39;].functionality == 0.0 and N.G.node[v][&#39;data&#39;][&#39;inf_data&#39;].functionality==1.0:</span>
<span class="c1">#                N.G.node[v][&#39;data&#39;][&#39;inf_data&#39;].functionality = 0.0</span>
<span class="c1">#            if N.G.node[u][&#39;data&#39;][&#39;inf_data&#39;].functionality == 1.0 and N.G.node[v][&#39;data&#39;][&#39;inf_data&#39;].repaired==1.0 and N.G.node[v][&#39;data&#39;][&#39;inf_data&#39;].functionality==0.0:</span>
<span class="c1">#                N.G.node[v][&#39;data&#39;][&#39;inf_data&#39;].functionality = 1.0</span>

<div class="viewcode-block" id="create_functionality_matrix"><a class="viewcode-back" href="../indp.html#indp.create_functionality_matrix">[docs]</a><span class="k">def</span> <span class="nf">create_functionality_matrix</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">layers</span><span class="p">,</span><span class="n">actions</span><span class="p">,</span><span class="n">strategy_type</span><span class="o">=</span><span class="s2">&quot;OPTIMISTIC&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a functionality map for input into the functionality parameter in the indp function.</span>
<span class="sd">    :param N: An InfrastructureNetwork instance (created in infrastructure.py)</span>
<span class="sd">    :param T: Number of timesteps to optimize over.</span>
<span class="sd">    :param layers: Layer IDs of N included in the optimization.</span>
<span class="sd">    :param actions: An array of actions from a previous optimization. Likely taken from an INDPResults variable &#39;indp_result[t][&#39;actions&#39;]&#39;.</span>
<span class="sd">    :param strategy_type: If no actions are provided, assigns a default functionality. Options are: &quot;OPTIMISTIC&quot;, &quot;PESSIMISTIC&quot; or &quot;INFO_SHARE&quot;</span>
<span class="sd">    :returns: A functionality dictionary used for input into indp.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">functionality</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">G_prime_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">N</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">net_id</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">]</span>
    <span class="n">G_prime</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">G_prime_nodes</span><span class="p">)</span>
    <span class="n">N_prime</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">G_prime</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">repaired</span><span class="o">==</span><span class="mf">0.0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
        <span class="n">functionality</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">functional_nodes</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">t_p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">functionality</span><span class="p">[</span><span class="n">t_p</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">functionality</span><span class="p">[</span><span class="n">t_p</span><span class="p">][</span><span class="n">key</span><span class="p">]</span><span class="o">==</span><span class="mf">1.0</span><span class="p">:</span>
                    <span class="n">functionality</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">strategy_type</span> <span class="o">==</span> <span class="s2">&quot;INFO_SHARE&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">[</span><span class="n">t</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">a</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
                    <span class="n">node</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">layer</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
                        <span class="n">functional_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">node</span><span class="p">,</span><span class="n">layer</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="n">G_prime</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="c1">#print &quot;layers=&quot;,layers,&quot;n=&quot;,n</span>
            <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">net_id</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="ow">in</span> <span class="n">N_prime</span> <span class="ow">and</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">functional_nodes</span><span class="p">:</span>
                    <span class="n">functionality</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="mf">1.0</span>
                <span class="k">elif</span> <span class="n">G_prime</span><span class="o">.</span><span class="n">has_node</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">N_prime</span><span class="p">:</span>
                    <span class="n">functionality</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="mf">1.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">strategy_type</span> <span class="o">==</span> <span class="s2">&quot;OPTIMISTIC&quot;</span><span class="p">:</span>
                        <span class="n">functionality</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="mf">1.0</span>
                    <span class="k">elif</span> <span class="n">strategy_type</span> <span class="o">==</span> <span class="s2">&quot;PESSIMISTIC&quot;</span><span class="p">:</span>
                        <span class="n">functionality</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
                    <span class="k">elif</span> <span class="n">strategy_type</span> <span class="o">==</span> <span class="s2">&quot;REALISTIC&quot;</span><span class="p">:</span>
                        <span class="n">functionality</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">functionality</span><span class="p">[</span><span class="n">t</span><span class="p">]:</span>
                            <span class="n">functionality</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">return</span> <span class="n">functionality</span></div>


<div class="viewcode-block" id="initialize_network"><a class="viewcode-back" href="../indp.html#indp.initialize_network">[docs]</a><span class="k">def</span> <span class="nf">initialize_network</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="o">=</span><span class="s2">&quot;../data/INDP_7-20-2015/&quot;</span><span class="p">,</span><span class="n">external_interdependency_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">sim_number</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">cost_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">magnitude</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">sample</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">shelby_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">topology</span><span class="o">=</span><span class="s1">&#39;Random&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Initializes an InfrastructureNetwork from Shelby County data.</span>
<span class="sd">    :param BASE_DIR: Base directory of Shelby County data.</span>
<span class="sd">    :param sim_number: Which simulation number to use as input.</span>
<span class="sd">    :param cost_scale: Scales the cost to improve efficiency.</span>
<span class="sd">    :param magnitude: Magnitude of earthquake.</span>
<span class="sd">    :param v: v parameter</span>
<span class="sd">    :returns: An interdependent InfrastructureNetwork.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">layers_temp</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">v_temp</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">shelby_data</span><span class="p">:</span>
    <span class="c1">#    print &quot;Loading Shelby County data...&quot; #!!!</span>
        <span class="n">InterdepNet</span><span class="o">=</span><span class="n">load_infrastructure_data</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="o">=</span><span class="n">BASE_DIR</span><span class="p">,</span><span class="n">external_interdependency_dir</span><span class="o">=</span><span class="n">external_interdependency_dir</span><span class="p">,</span><span class="n">sim_number</span><span class="o">=</span><span class="n">sim_number</span><span class="p">,</span><span class="n">cost_scale</span><span class="o">=</span><span class="n">cost_scale</span><span class="p">,</span><span class="n">magnitude</span><span class="o">=</span><span class="n">magnitude</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
    <span class="c1">#    print &quot;Data loaded.&quot; #!!!</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">InterdepNet</span><span class="p">,</span><span class="n">v_temp</span><span class="p">,</span><span class="n">layers_temp</span><span class="o">=</span><span class="n">load_synthetic_network</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="o">=</span><span class="n">BASE_DIR</span><span class="p">,</span><span class="n">topology</span><span class="o">=</span><span class="n">topology</span><span class="p">,</span><span class="n">config</span><span class="o">=</span><span class="n">magnitude</span><span class="p">,</span><span class="n">sample</span><span class="o">=</span><span class="n">sample</span><span class="p">,</span><span class="n">cost_scale</span><span class="o">=</span><span class="n">cost_scale</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">InterdepNet</span><span class="p">,</span><span class="n">v_temp</span><span class="p">,</span><span class="n">layers_temp</span></div>


<div class="viewcode-block" id="initialize_sample_network"><a class="viewcode-back" href="../indp.html#indp.initialize_sample_network">[docs]</a><span class="k">def</span> <span class="nf">initialize_sample_network</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">{},</span><span class="n">layers</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot; Initializes sample 2x6 network</span>
<span class="sd">    :param params: (Currently not used).</span>
<span class="sd">    :param layers: (Currently not used).</span>
<span class="sd">    :returns: An interdependent InfrastructureNetwork.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">InterdepNet</span><span class="o">=</span><span class="n">InfrastructureNetwork</span><span class="p">(</span><span class="s2">&quot;2x8_centralized&quot;</span><span class="p">)</span>
    <span class="n">node_to_demand_dict</span><span class="o">=</span><span class="p">{(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span><span class="mi">5</span><span class="p">,(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span><span class="o">-</span><span class="mi">1</span><span class="p">,(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span><span class="o">-</span><span class="mi">2</span><span class="p">,(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span><span class="o">-</span><span class="mi">2</span><span class="p">,(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span><span class="o">-</span><span class="mi">4</span><span class="p">,(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span><span class="mi">4</span><span class="p">,</span>
                         <span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span><span class="o">-</span><span class="mi">2</span><span class="p">,(</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span><span class="mi">6</span><span class="p">,(</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span><span class="mi">1</span><span class="p">,(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span><span class="o">-</span><span class="mi">5</span><span class="p">,(</span><span class="mi">11</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span><span class="mi">4</span><span class="p">,(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span><span class="o">-</span><span class="mi">4</span><span class="p">}</span>
    <span class="n">space_to_nodes_dict</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">:[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">)],</span><span class="mi">2</span><span class="p">:[(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">)],</span>
                    <span class="mi">3</span><span class="p">:[(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">11</span><span class="p">,</span><span class="mi">2</span><span class="p">)],</span><span class="mi">4</span><span class="p">:[(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">)]}</span>
    <span class="n">arc_list</span><span class="o">=</span> <span class="p">[((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)),((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)),((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)),((</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)),((</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span>
               <span class="p">((</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">)),((</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)),((</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">)),((</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)),((</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">)),((</span><span class="mi">11</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">))]</span>
    <span class="n">interdep_list</span><span class="o">=</span><span class="p">[((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">)),((</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">)),((</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)),((</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">))]</span>
    <span class="n">failed_nodes</span><span class="o">=</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                  <span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">11</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">)]</span>
    <span class="n">global_index</span><span class="o">=</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node_to_demand_dict</span><span class="p">:</span>
        <span class="n">nn</span><span class="o">=</span><span class="n">InfrastructureNode</span><span class="p">(</span><span class="n">global_index</span><span class="p">,</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">nn</span><span class="o">.</span><span class="n">demand</span><span class="o">=</span><span class="n">node_to_demand_dict</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="n">nn</span><span class="o">.</span><span class="n">reconstruction_cost</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">demand</span><span class="p">)</span>
        <span class="n">nn</span><span class="o">.</span><span class="n">oversupply_penalty</span><span class="o">=</span><span class="mi">50</span>
        <span class="n">nn</span><span class="o">.</span><span class="n">undersupply_penalty</span><span class="o">=</span><span class="mi">50</span>
        <span class="n">nn</span><span class="o">.</span><span class="n">resource_usage</span><span class="o">=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">failed_nodes</span><span class="p">:</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="mf">0.0</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">repaired</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">InterdepNet</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">((</span><span class="n">nn</span><span class="o">.</span><span class="n">local_id</span><span class="p">,</span><span class="n">nn</span><span class="o">.</span><span class="n">net_id</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;inf_data&#39;</span><span class="p">:</span><span class="n">nn</span><span class="p">})</span>
        <span class="n">global_index</span><span class="o">+=</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">space_to_nodes_dict</span><span class="p">:</span>
        <span class="n">InterdepNet</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">InfrastructureSpace</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">space_to_nodes_dict</span><span class="p">[</span><span class="n">s</span><span class="p">]:</span>
            <span class="n">InterdepNet</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">space</span><span class="o">=</span><span class="n">s</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">arc_list</span><span class="p">:</span>
        <span class="n">aa</span><span class="o">=</span><span class="n">InfrastructureArc</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">aa</span><span class="o">.</span><span class="n">flow_cost</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">aa</span><span class="o">.</span><span class="n">capacity</span><span class="o">=</span><span class="mi">50</span>
        <span class="n">InterdepNet</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="n">aa</span><span class="o">.</span><span class="n">source</span><span class="p">,</span><span class="n">aa</span><span class="o">.</span><span class="n">layer</span><span class="p">),(</span><span class="n">aa</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span><span class="n">aa</span><span class="o">.</span><span class="n">layer</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;inf_data&#39;</span><span class="p">:</span><span class="n">aa</span><span class="p">})</span>
    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">interdep_list</span><span class="p">:</span>
        <span class="n">aa</span><span class="o">=</span><span class="n">InfrastructureInterdepArc</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">InterdepNet</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="n">aa</span><span class="o">.</span><span class="n">source</span><span class="p">,</span><span class="n">aa</span><span class="o">.</span><span class="n">source_layer</span><span class="p">),(</span><span class="n">aa</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span><span class="n">aa</span><span class="o">.</span><span class="n">dest_layer</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;inf_data&#39;</span><span class="p">:</span><span class="n">aa</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">InterdepNet</span></div>

<div class="viewcode-block" id="run_sample"><a class="viewcode-back" href="../indp.html#indp.run_sample">[docs]</a><span class="k">def</span> <span class="nf">run_sample</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Runs the sample network generated in initialize_sample_network through indp.</span>
<span class="sd">    :param params: Global parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">N</span><span class="o">=</span><span class="n">initialize_sample_network</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">N</span>
    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;V&quot;</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span>
    <span class="n">run_indp</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></div>

<div class="viewcode-block" id="run_indp"><a class="viewcode-back" href="../indp.html#indp.run_indp">[docs]</a><span class="k">def</span> <span class="nf">run_indp</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">layers</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="n">controlled_layers</span><span class="o">=</span><span class="p">[],</span><span class="n">functionality</span><span class="o">=</span><span class="p">{},</span><span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">forced_actions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">saveModel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">print_cmd_line</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Runs an INDP problem with specified parameters. Outputs to directory specified in params[&#39;OUTPUT_DIR&#39;].</span>
<span class="sd">    :param params: Global parameters.</span>
<span class="sd">    :param layers: Layers to consider in the infrastructure network.</span>
<span class="sd">    :param T: Number of timesteps to optimize over.</span>
<span class="sd">    :param validate: Validate solution.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize failure scenario.</span>
    <span class="n">InterdepNet</span><span class="o">=</span><span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;N&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">InterdepNet</span><span class="o">=</span><span class="n">initialize_network</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="o">=</span><span class="s2">&quot;../data/INDP_7-20-2015/&quot;</span><span class="p">,</span><span class="n">sim_number</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;SIM_NUMBER&#39;</span><span class="p">],</span><span class="n">magnitude</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;MAGNITUDE&quot;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">InterdepNet</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s2">&quot;NUM_ITERATIONS&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;NUM_ITERATIONS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">controlled_layers</span><span class="p">:</span>
        <span class="n">controlled_layers</span> <span class="o">=</span> <span class="n">layers</span>

    <span class="n">v_r</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;V&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v_r</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">)):</span>
        <span class="n">outDirSuffixRes</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">v_r</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">v_r</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">outDirSuffixRes</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">v_r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">outDirSuffixRes</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">v_r</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;_fixed_layer_Cap&#39;</span>

    <span class="n">indp_results</span><span class="o">=</span><span class="n">INDPResults</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;L&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">T</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--Running INDP (T=1) or iterative INDP.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">print_cmd_line</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Num iters=&quot;</span><span class="p">,</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;NUM_ITERATIONS&quot;</span><span class="p">])</span>

        <span class="c1"># Run INDP for 1 time step (original INDP).</span>
        <span class="n">output_dir</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;OUTPUT_DIR&quot;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_L&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">layers</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;_m&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;MAGNITUDE&quot;</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;_v&quot;</span><span class="o">+</span><span class="n">outDirSuffixRes</span>
        <span class="c1"># Initial calculations.</span>
        <span class="n">results</span><span class="o">=</span><span class="n">indp</span><span class="p">(</span><span class="n">InterdepNet</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">layers</span><span class="p">,</span><span class="n">controlled_layers</span><span class="o">=</span><span class="n">controlled_layers</span><span class="p">)</span>
        <span class="n">indp_results</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">indp_results</span><span class="o">.</span><span class="n">add_components</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">INDPComponents</span><span class="o">.</span><span class="n">calculate_components</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">InterdepNet</span><span class="p">,</span><span class="n">layers</span><span class="o">=</span><span class="n">controlled_layers</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;NUM_ITERATIONS&quot;</span><span class="p">]):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-Time Step (iINDP)&quot;</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;/&quot;</span><span class="p">,</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;NUM_ITERATIONS&quot;</span><span class="p">])</span>
            <span class="n">results</span><span class="o">=</span><span class="n">indp</span><span class="p">(</span><span class="n">InterdepNet</span><span class="p">,</span><span class="n">v_r</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">layers</span><span class="p">,</span><span class="n">controlled_layers</span><span class="o">=</span><span class="n">controlled_layers</span><span class="p">,</span><span class="n">forced_actions</span><span class="o">=</span><span class="n">forced_actions</span><span class="p">)</span>
            <span class="n">indp_results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">t_offset</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">saveModel</span><span class="p">:</span>
                <span class="n">save_INDP_model_to_file</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">output_dir</span><span class="o">+</span><span class="s2">&quot;/Model&quot;</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># Modify network to account for recovery and calculate components.</span>
            <span class="n">apply_recovery</span><span class="p">(</span><span class="n">InterdepNet</span><span class="p">,</span><span class="n">indp_results</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">indp_results</span><span class="o">.</span><span class="n">add_components</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">INDPComponents</span><span class="o">.</span><span class="n">calculate_components</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">InterdepNet</span><span class="p">,</span><span class="n">layers</span><span class="o">=</span><span class="n">controlled_layers</span><span class="p">))</span>
<span class="c1">#            print &quot;Num_iters=&quot;,params[&quot;NUM_ITERATIONS&quot;]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># td-INDP formulations. Includes &quot;DELTA_T&quot; parameter for sliding windows to increase</span>
        <span class="c1"># efficiency.</span>
        <span class="c1"># Edit 2/8/16: &quot;Sliding window&quot; now overlaps.</span>
        <span class="n">num_time_windows</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">time_window_length</span><span class="o">=</span><span class="n">T</span>
        <span class="n">is_first_iteration</span><span class="o">=</span><span class="kc">True</span>
        <span class="k">if</span> <span class="s2">&quot;WINDOW_LENGTH&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">time_window_length</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;WINDOW_LENGTH&quot;</span><span class="p">]</span>
            <span class="n">num_time_windows</span><span class="o">=</span><span class="n">T</span>
        <span class="n">output_dir</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;OUTPUT_DIR&quot;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_L&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">layers</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;_m&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;MAGNITUDE&quot;</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;_v&quot;</span><span class="o">+</span><span class="n">outDirSuffixRes</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running td-INDP (T=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;, Window size=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">time_window_length</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
        <span class="c1"># Initial percolation calculations.</span>
        <span class="n">results</span><span class="o">=</span><span class="n">indp</span><span class="p">(</span><span class="n">InterdepNet</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">layers</span><span class="p">,</span><span class="n">controlled_layers</span><span class="o">=</span><span class="n">controlled_layers</span><span class="p">,</span><span class="n">functionality</span><span class="o">=</span><span class="n">functionality</span><span class="p">)</span>
        <span class="n">indp_results</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">indp_results</span><span class="o">.</span><span class="n">add_components</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">INDPComponents</span><span class="o">.</span><span class="n">calculate_components</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">InterdepNet</span><span class="p">,</span><span class="n">layers</span><span class="o">=</span><span class="n">controlled_layers</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_time_windows</span><span class="p">):</span>
            <span class="n">functionality_t</span><span class="o">=</span><span class="p">{}</span>
            <span class="c1"># Slide functionality matrix according to sliding time window.</span>
            <span class="k">if</span> <span class="n">functionality</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">functionality</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">time_window_length</span><span class="o">+</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                        <span class="n">functionality_t</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">functionality</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">functionality_t</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">time_window_length</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">diff</span><span class="o">=</span><span class="n">time_window_length</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">functionality_t</span><span class="p">)</span>
                    <span class="n">max_t</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">functionality_t</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">diff</span><span class="p">):</span>
                        <span class="n">functionality_t</span><span class="p">[</span><span class="n">max_t</span><span class="o">+</span><span class="n">d</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">functionality_t</span><span class="p">[</span><span class="n">max_t</span><span class="p">]</span>
            <span class="c1"># Run td-INDP.</span>
            <span class="n">results</span><span class="o">=</span><span class="n">indp</span><span class="p">(</span><span class="n">InterdepNet</span><span class="p">,</span><span class="n">v_r</span><span class="p">,</span><span class="n">time_window_length</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">layers</span><span class="p">,</span><span class="n">controlled_layers</span><span class="o">=</span><span class="n">controlled_layers</span><span class="p">,</span><span class="n">functionality</span><span class="o">=</span><span class="n">functionality_t</span><span class="p">,</span><span class="n">forced_actions</span><span class="o">=</span><span class="n">forced_actions</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">saveModel</span><span class="p">:</span>
                <span class="n">save_INDP_model_to_file</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">output_dir</span><span class="o">+</span><span class="s2">&quot;/Model&quot;</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;WINDOW_LENGTH&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="n">indp_results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">t_offset</span><span class="o">=</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">t_start</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">t_end</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="c1"># Modify network for recovery actions and calculate components.</span>
                <span class="n">apply_recovery</span><span class="p">(</span><span class="n">InterdepNet</span><span class="p">,</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">indp_results</span><span class="o">.</span><span class="n">add_components</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">INDPComponents</span><span class="o">.</span><span class="n">calculate_components</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">InterdepNet</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">layers</span><span class="o">=</span><span class="n">controlled_layers</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">indp_results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">t_offset</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="p">):</span>
                    <span class="c1"># Modify network to account for recovery actions.</span>
                    <span class="n">apply_recovery</span><span class="p">(</span><span class="n">InterdepNet</span><span class="p">,</span><span class="n">indp_results</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
                    <span class="n">indp_results</span><span class="o">.</span><span class="n">add_components</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">INDPComponents</span><span class="o">.</span><span class="n">calculate_components</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">InterdepNet</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">layers</span><span class="o">=</span><span class="n">controlled_layers</span><span class="p">))</span>
    <span class="c1"># Save results of INDP run.</span>
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
        <span class="n">indp_results</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;SIM_NUMBER&quot;</span><span class="p">],</span><span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_dir</span><span class="o">+</span><span class="s1">&#39;/agents&#39;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="o">+</span><span class="s1">&#39;/agents&#39;</span><span class="p">)</span>
        <span class="n">indp_results</span><span class="o">.</span><span class="n">to_csv_layer</span><span class="p">(</span><span class="n">output_dir</span><span class="o">+</span><span class="s1">&#39;/agents&#39;</span><span class="p">,</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;SIM_NUMBER&quot;</span><span class="p">],</span><span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">indp_results</span></div>


<div class="viewcode-block" id="run_info_share"><a class="viewcode-back" href="../indp.html#indp.run_info_share">[docs]</a><span class="k">def</span> <span class="nf">run_info_share</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">layers</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Applies rounds of information sharing between INDP runs. Assumes each layer is controlled by a separate player.</span>
<span class="sd">    params[&quot;NUM_ITERATIONS&quot;] determines how many rounds of sharing to perform.</span>
<span class="sd">    NOTE: This is still not fully functional.</span>
<span class="sd">    :param params: Global parameters.</span>
<span class="sd">    :param layers: Specifies which layers to optimize over.</span>
<span class="sd">    :param T: Number of timesteps to optimize over.</span>
<span class="sd">    :param validate: (Currently not used.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize network.</span>
    <span class="n">InterdepNet</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">num_iterations</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;NUM_ITERATIONS&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s2">&quot;N&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">InterdepNet</span><span class="o">=</span><span class="n">initialize_network</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="o">=</span><span class="s2">&quot;../data/INDP_7-20-2015/&quot;</span><span class="p">,</span><span class="n">sim_number</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;SIM_NUMBER&#39;</span><span class="p">],</span><span class="n">magnitude</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;MAGNITUDE&quot;</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">InterdepNet</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">InterdepNet</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s2">&quot;NUM_ITERATIONS&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;NUM_ITERATIONS&quot;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">v_r</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;V&quot;</span><span class="p">]</span>
    <span class="c1"># Initialize player result variables.</span>
    <span class="n">player_strategies</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">P</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
        <span class="n">player_strategies</span><span class="p">[</span><span class="n">P</span><span class="p">]</span><span class="o">=</span><span class="n">INDPResults</span><span class="p">()</span>

    <span class="c1"># Begin Sharing Process.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_iterations</span><span class="p">):</span>
        <span class="n">results</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">P</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
            <span class="n">negP</span><span class="o">=</span><span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">layers</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">P</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;P=&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">P</span><span class="p">),</span><span class="s2">&quot;i=&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Create functionality matrix. This corresponds to &quot;OPTIMISTIC&quot; or &quot;PESSIMISTIC&quot; in Sharkey paper.</span>
                <span class="c1"># OPTIMISTIC implies that interdependencies are assumed to be fixed whenever a player needs them to be.</span>
                <span class="c1"># PESSIMISTIC assumes interdependencies never become fixed.</span>
                <span class="n">functionality</span><span class="o">=</span><span class="n">create_functionality_matrix</span><span class="p">(</span><span class="n">InterdepNet</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">negP</span><span class="p">,</span><span class="n">actions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">strategy_type</span><span class="o">=</span><span class="s2">&quot;OPTIMISTIC&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Next iteration!&quot;</span><span class="p">)</span>
                <span class="n">actions</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">negP</span><span class="p">:</span>
                        <span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">player_strategies</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="n">t</span><span class="p">][</span><span class="s2">&quot;actions&quot;</span><span class="p">])</span>
                <span class="n">functionality</span><span class="o">=</span><span class="n">create_functionality_matrix</span><span class="p">(</span><span class="n">InterdepNet</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">negP</span><span class="p">,</span><span class="n">actions</span><span class="o">=</span><span class="n">actions</span><span class="p">,</span><span class="n">strategy_type</span><span class="o">=</span><span class="s2">&quot;INFO_SHARE&quot;</span><span class="p">)</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">InterdepNet</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">results</span><span class="p">[</span><span class="n">P</span><span class="p">]</span><span class="o">=</span><span class="n">run_indp</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">layers</span><span class="p">,</span><span class="n">controlled_layers</span><span class="o">=</span><span class="p">[</span><span class="n">P</span><span class="p">],</span><span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span><span class="n">functionality</span><span class="o">=</span><span class="n">functionality</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;P&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">P</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;_i&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">suffix</span><span class="p">,</span><span class="n">forced_actions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">P</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
            <span class="n">player_strategies</span><span class="p">[</span><span class="n">P</span><span class="p">]</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="n">P</span><span class="p">]</span></div>

<span class="k">def</span> <span class="nf">run_inrg</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">layers</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">player_ordering</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="n">InterdepNet</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;OUTPUT_DIR&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;_m&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;MAGNITUDE&quot;</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;_v&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;V&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;N&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">InterdepNet</span><span class="o">=</span><span class="n">initialize_network</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="o">=</span><span class="s2">&quot;../data/INDP_7-20-2015/&quot;</span><span class="p">,</span><span class="n">sim_number</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;SIM_NUMBER&#39;</span><span class="p">],</span><span class="n">magnitude</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;MAGNITUDE&quot;</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">InterdepNet</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">InterdepNet</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">]</span>
    <span class="n">v_r</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;V&quot;</span><span class="p">]</span>
    <span class="c1"># Initialize player result variables.</span>
    <span class="n">player_strategies</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">P</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
        <span class="n">player_strategies</span><span class="p">[</span><span class="n">P</span><span class="p">]</span><span class="o">=</span><span class="n">INDPResults</span><span class="p">()</span>
    <span class="n">num_iterations</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;NUM_ITERATIONS&quot;</span><span class="p">]</span>
    <span class="n">params_temp</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">params_temp</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="n">params_temp</span><span class="p">[</span><span class="s2">&quot;NUM_ITERATIONS&quot;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_iterations</span><span class="p">):</span>
        <span class="n">curr_player_ordering</span><span class="o">=</span><span class="n">player_ordering</span>
        <span class="k">if</span> <span class="n">player_ordering</span> <span class="o">==</span> <span class="s2">&quot;RANDOM&quot;</span><span class="p">:</span>
            <span class="n">curr_player_ordering</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">layers</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">P</span> <span class="ow">in</span> <span class="n">curr_player_ordering</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Iteration&quot;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s2">&quot;, Player&quot;</span><span class="p">,</span><span class="n">P</span><span class="p">)</span>
            <span class="c1">#functionality=create_functionality_matrix(InterdepNet,1,[x for x in layers if x != P],strategy_type=&quot;REALISTIC&quot;)</span>
            <span class="n">results</span><span class="o">=</span><span class="n">run_indp</span><span class="p">(</span><span class="n">params_temp</span><span class="p">,</span><span class="n">layers</span><span class="p">,</span><span class="n">controlled_layers</span><span class="o">=</span><span class="p">[</span><span class="n">P</span><span class="p">],</span><span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;P&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">P</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;_i&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">forced_actions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1">#print params[&quot;N&quot;].G.node[(5,3)][&#39;data&#39;][&#39;inf_data&#39;].functionality</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">player_strategies</span><span class="p">[</span><span class="n">P</span><span class="p">]</span><span class="o">=</span><span class="n">results</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">player_strategies</span><span class="p">[</span><span class="n">P</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">results</span><span class="p">,</span><span class="n">t_offset</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">t_start</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">t_end</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">P</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
        <span class="n">player_strategies</span><span class="p">[</span><span class="n">P</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;SIM_NUMBER&quot;</span><span class="p">],</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;P&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">P</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">suffix</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">run_seqeq</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">layers</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">player_ordering</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="n">InterdepNet</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;OUTPUT_DIR&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;_m&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;MAGNITUDE&quot;</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;_v&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;V&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;N&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">InterdepNet</span><span class="o">=</span><span class="n">initialize_network</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="o">=</span><span class="s2">&quot;../data/INDP_7-20-2015/&quot;</span><span class="p">,</span><span class="n">sim_number</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;SIM_NUMBER&#39;</span><span class="p">],</span><span class="n">magnitude</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;MAGNITUDE&quot;</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">InterdepNet</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">InterdepNet</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">]</span>
    <span class="n">v_r</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;V&quot;</span><span class="p">]</span>



<div class="viewcode-block" id="baseline_metrics"><a class="viewcode-back" href="../indp.html#indp.baseline_metrics">[docs]</a><span class="k">def</span> <span class="nf">baseline_metrics</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="o">=</span><span class="s2">&quot;/Users/Andrew/Dropbox/iINDP&quot;</span><span class="p">,</span><span class="n">layers</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot; Calculate and print baseline metrics of undamaged network.</span>
<span class="sd">    :param BASE_DIR: Base directory for INDP/Shelby County data.</span>
<span class="sd">    :param layers: Specifies which layers to calculate metrics for.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">N</span><span class="o">=</span><span class="n">initialize_network</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span><span class="n">sim_number</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">G</span><span class="o">=</span><span class="n">N</span><span class="o">.</span><span class="n">G</span>
    <span class="n">costs_disconnection</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="n">costs_no_disconnection</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="n">opt_flow_cost</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">net_id</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
            <span class="n">demand</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">demand</span>
            <span class="k">if</span> <span class="n">demand</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">costs_disconnection</span><span class="o">+=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">oversupply_penalty</span><span class="o">*</span><span class="n">demand</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">costs_disconnection</span><span class="o">+=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">undersupply_penalty</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">demand</span><span class="p">)</span>
            <span class="n">costs_disconnection</span><span class="o">+=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reconstruction_cost</span>
            <span class="n">costs_no_disconnection</span><span class="o">+=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reconstruction_cost</span>
    <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">layers</span> <span class="ow">and</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
            <span class="n">costs_disconnection</span><span class="o">+=</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reconstruction_cost</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
            <span class="n">costs_no_disconnection</span><span class="o">+=</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reconstruction_cost</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">N</span><span class="o">.</span><span class="n">S</span><span class="p">:</span>
        <span class="n">costs_disconnection</span><span class="o">+=</span><span class="n">s</span><span class="o">.</span><span class="n">cost</span>
        <span class="n">costs_no_disconnection</span><span class="o">+=</span><span class="n">s</span><span class="o">.</span><span class="n">cost</span>
    <span class="n">results</span><span class="o">=</span><span class="n">indp</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">opt_flow_cost</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;Flow&quot;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Costs with disconnection:&quot;</span><span class="p">,</span><span class="n">costs_disconnection</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Costs w/o disconnection: &quot;</span><span class="p">,</span><span class="n">costs_no_disconnection</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Nominal flow cost:       &quot;</span><span class="p">,</span><span class="n">opt_flow_cost</span><span class="p">)</span></div>
<span class="c1">#baseline_metrics(layers=[1,3],BASE_DIR=HOME_DIR+&quot;/Dropbox/iINDP&quot;)</span>

<span class="k">def</span> <span class="nf">save_INDP_model_to_file</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">outModelDir</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outModelDir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">outModelDir</span><span class="p">)</span>
    <span class="c1"># Write models to file</span>
    <span class="n">lname</span> <span class="o">=</span> <span class="s2">&quot;/Model_t</span><span class="si">%d</span><span class="s2">_l</span><span class="si">%d</span><span class="s2">_</span><span class="si">%s</span><span class="s2">.lp&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">suffix</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outModelDir</span><span class="o">+</span><span class="n">lname</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
     <span class="c1"># Write solution to file</span>
    <span class="n">sname</span> <span class="o">=</span> <span class="s2">&quot;/Solution_t</span><span class="si">%d</span><span class="s2">_l</span><span class="si">%d</span><span class="s2">_</span><span class="si">%s</span><span class="s2">.txt&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">suffix</span><span class="p">)</span>
    <span class="n">fileID</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outModelDir</span><span class="o">+</span><span class="n">sname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">getVars</span><span class="p">():</span>
        <span class="n">fileID</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%g</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">vv</span><span class="o">.</span><span class="n">varName</span><span class="p">,</span> <span class="n">vv</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
    <span class="n">fileID</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Obj: </span><span class="si">%g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">model</span><span class="o">.</span><span class="n">objVal</span><span class="p">)</span>
    <span class="n">fileID</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">plot_indp_sample</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">folderSuffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="n">InterdepNet</span><span class="o">=</span><span class="n">initialize_sample_network</span><span class="p">()</span>
    <span class="n">pos</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">spring_layout</span><span class="p">(</span><span class="n">InterdepNet</span><span class="o">.</span><span class="n">G</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">pos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
         <span class="n">pos</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">0.5</span>
         <span class="n">pos</span><span class="p">[(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">0.5</span>
         <span class="n">pos</span><span class="p">[(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">0.0</span>
         <span class="n">pos</span><span class="p">[(</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">0.0</span>
         <span class="n">pos</span><span class="p">[(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">2.0</span>
         <span class="n">pos</span><span class="p">[(</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">2.0</span>
         <span class="n">pos</span><span class="p">[(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">1.5</span>
         <span class="n">pos</span><span class="p">[(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">1.5</span>
         <span class="n">pos</span><span class="p">[(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">3.0</span>
         <span class="n">pos</span><span class="p">[(</span><span class="mi">11</span><span class="p">,</span><span class="mi">2</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">3.0</span>
         <span class="n">pos</span><span class="p">[(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">2.5</span>
         <span class="n">pos</span><span class="p">[(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">2.5</span>
         <span class="n">pos</span><span class="p">[(</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">)][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">0.0</span>
         <span class="n">pos</span><span class="p">[(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">0.0</span>
         <span class="n">pos</span><span class="p">[(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">)][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">0.0</span>
         <span class="n">pos</span><span class="p">[(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">)][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">1.0</span>
         <span class="n">pos</span><span class="p">[(</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">)][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">1.0</span>
         <span class="n">pos</span><span class="p">[(</span><span class="mi">11</span><span class="p">,</span><span class="mi">2</span><span class="p">)][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">1.0</span>
         <span class="n">pos</span><span class="p">[(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">2.0</span>
         <span class="n">pos</span><span class="p">[(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">2.0</span>
         <span class="n">pos</span><span class="p">[(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">)][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">2.0</span>
         <span class="n">pos</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">3.0</span>
         <span class="n">pos</span><span class="p">[(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">3.0</span>
         <span class="n">pos</span><span class="p">[(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">3.0</span>

    <span class="n">node_dict</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">:[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">)],</span> <span class="mi">11</span><span class="p">:[(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)],</span> <span class="mi">12</span><span class="p">:[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">)],</span>
               <span class="mi">2</span><span class="p">:[(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">11</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">)],</span> <span class="mi">21</span><span class="p">:[(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)],</span> <span class="mi">22</span><span class="p">:[(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">11</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">)]}</span>
    <span class="n">arc_dict</span><span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="p">[((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)),((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)),((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)),((</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)),((</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">))],</span>
                   <span class="mi">2</span><span class="p">:</span> <span class="p">[((</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">)),((</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)),((</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">)),((</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)),((</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">)),((</span><span class="mi">11</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">))]}</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="n">InterdepNet</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">labels</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">[</span><span class="si">%d</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">demand</span><span class="p">)</span>
    <span class="n">pos_moved</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">pos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">pos_moved</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">pos_moved</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.2</span>
        <span class="n">pos_moved</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.2</span>

    <span class="n">v_r</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;V&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v_r</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">)):</span>
        <span class="n">totalResource</span> <span class="o">=</span> <span class="n">v_r</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v_r</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">totalResource</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v_r</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">totalResource</span> <span class="o">=</span> <span class="n">v_r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">output_dir</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;OUTPUT_DIR&quot;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_L&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;L&quot;</span><span class="p">]))</span><span class="o">+</span><span class="s1">&#39;_m&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;MAGNITUDE&quot;</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;_v&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">totalResource</span><span class="p">)</span><span class="o">+</span><span class="n">folderSuffix</span>
    <span class="n">action_file</span> <span class="o">=</span><span class="n">output_dir</span><span class="o">+</span><span class="s2">&quot;/actions_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;SIM_NUMBER&quot;</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">suffix</span><span class="o">+</span><span class="s2">&quot;.csv&quot;</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:[]}</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">action_file</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">action_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="n">data</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="n">t</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">action</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">t</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
                    <span class="n">actions</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
                <span class="n">actions</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

    <span class="n">T</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">actions</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">actions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span> <span class="p">,</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Time = </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">t</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">data</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="n">node_dict</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
            <span class="n">node_dict</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">InterdepNet</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span><span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_labels</span><span class="p">(</span><span class="n">InterdepNet</span><span class="o">.</span><span class="n">G</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span><span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span>
                                <span class="n">font_color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">font_family</span><span class="o">=</span><span class="s1">&#39;CMU Serif&#39;</span><span class="p">,</span><span class="n">font_weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="n">InterdepNet</span><span class="o">.</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">nodelist</span><span class="o">=</span><span class="n">node_dict</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;#b51717&#39;</span><span class="p">,</span><span class="n">node_size</span><span class="o">=</span><span class="mi">1100</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="n">InterdepNet</span><span class="o">.</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">nodelist</span><span class="o">=</span><span class="n">node_dict</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;#005f98&#39;</span><span class="p">,</span><span class="n">node_size</span><span class="o">=</span><span class="mi">1100</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="n">InterdepNet</span><span class="o">.</span><span class="n">G</span><span class="p">,</span><span class="n">pos_moved</span><span class="p">,</span><span class="n">nodelist</span><span class="o">=</span><span class="n">node_dict</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span><span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">node_shape</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span><span class="n">node_size</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="n">InterdepNet</span><span class="o">.</span><span class="n">G</span><span class="p">,</span><span class="n">pos_moved</span><span class="p">,</span><span class="n">nodelist</span><span class="o">=</span><span class="n">node_dict</span><span class="p">[</span><span class="mi">22</span><span class="p">],</span><span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">node_shape</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span><span class="n">node_size</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="n">InterdepNet</span><span class="o">.</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">edgelist</span><span class="o">=</span><span class="n">arc_dict</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="n">edge_color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="n">InterdepNet</span><span class="o">.</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">edgelist</span><span class="o">=</span><span class="n">arc_dict</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="n">edge_color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output_dir</span><span class="o">+</span><span class="s1">&#39;/plot_net&#39;</span><span class="o">+</span><span class="n">folderSuffix</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Hesam Talebiyan

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>