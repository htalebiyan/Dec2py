

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="Python 3.7.6" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="Python 3.7.6" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>infrastructure &mdash; Decenalized Decision Making 0.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Decenalized Decision Making
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Topics:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../main_vars.html">Input Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../run_main.html">Run INDP and Judgment Call</a></li>
<li class="toctree-l1"><a class="reference internal" href="../indp_main.html">Interdependent Network Design Problem (INDP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dindp_main.html">Judgment Call Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gameclasses.html">Restoration Game Classes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Decenalized Decision Making</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>infrastructure</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for infrastructure</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">indputils</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="k">class</span> <span class="nc">InfrastructureNode</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">net_id</span><span class="p">,</span><span class="n">local_id</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net_id</span><span class="o">=</span><span class="n">net_id</span>
        <span class="k">if</span> <span class="n">local_id</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">local_id</span><span class="o">=</span><span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">local_id</span><span class="o">=</span><span class="n">local_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failure_probability</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repaired</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruction_cost</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oversupply_penalty</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">undersupply_penalty</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">demand</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource_usage</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">def</span> <span class="nf">set_failure_probability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">failure_probability</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failure_probability</span><span class="o">=</span><span class="n">failure_probability</span>
    <span class="k">def</span> <span class="nf">in_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">space_id</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">space</span> <span class="o">==</span><span class="n">space_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
    
<span class="k">class</span> <span class="nc">InfrastructureArc</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">source</span><span class="p">,</span><span class="n">dest</span><span class="p">,</span><span class="n">layer</span><span class="p">,</span><span class="n">is_interdep</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">=</span><span class="n">source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="o">=</span><span class="n">dest</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer</span><span class="o">=</span><span class="n">layer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failure_probability</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repaired</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flow_cost</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruction_cost</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource_usage</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capacity</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_interdep</span><span class="o">=</span><span class="n">is_interdep</span>
    <span class="k">def</span> <span class="nf">in_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">space_id</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">space</span> <span class="o">==</span> <span class="n">space_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

<span class="k">class</span> <span class="nc">InfrastructureInterdepArc</span><span class="p">(</span><span class="n">InfrastructureArc</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">source</span><span class="p">,</span><span class="n">dest</span><span class="p">,</span><span class="n">source_layer</span><span class="p">,</span><span class="n">dest_layer</span><span class="p">,</span><span class="n">gamma</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">InfrastructureInterdepArc</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">dest</span><span class="p">,</span><span class="n">source_layer</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_layer</span><span class="o">=</span><span class="n">source_layer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dest_layer</span><span class="o">=</span><span class="n">dest_layer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span>

<span class="k">class</span> <span class="nc">InfrastructureSpace</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">cost</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cost</span><span class="o">=</span><span class="n">cost</span>

<div class="viewcode-block" id="InfrastructureNetwork"><a class="viewcode-back" href="../infrastructure.html#infrastructure.InfrastructureNetwork">[docs]</a><span class="k">class</span> <span class="nc">InfrastructureNetwork</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Stores information of the infrastructure network</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="nb">id</span>
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">newNet</span><span class="o">=</span><span class="n">InfrastructureNetwork</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">newNet</span><span class="o">.</span><span class="n">G</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">newNet</span><span class="o">.</span><span class="n">S</span><span class="o">=</span><span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">newNet</span>
    <span class="k">def</span> <span class="nf">update_with_strategy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">player_strategy</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">player_strategy</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">node</span><span class="o">=</span><span class="n">q</span>
            <span class="n">strat</span><span class="o">=</span><span class="n">player_strategy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">q</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">q</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">repaired</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">strat</span><span class="p">[</span><span class="s1">&#39;repair&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">q</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">strat</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">player_strategy</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">src</span><span class="o">=</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">dst</span><span class="o">=</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">strat</span> <span class="o">=</span> <span class="n">player_strategy</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">q</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">src</span><span class="p">][</span><span class="n">dst</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">repaired</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">strat</span><span class="p">[</span><span class="s1">&#39;repair&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">src</span><span class="p">][</span><span class="n">dst</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">strat</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">get_clusters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">layer</span><span class="p">):</span>
        <span class="n">G_prime_nodes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">net_id</span> <span class="o">==</span> <span class="n">layer</span> <span class="ow">and</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="o">==</span><span class="mf">1.0</span><span class="p">]</span>
        <span class="n">G_prime</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">G_prime_nodes</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="n">G_prime</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">([(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">G_prime</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="o">==</span><span class="mf">0.0</span><span class="p">])</span>
        <span class="c1">#print nx.connected_components(G_prime.to_undirected())</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(</span><span class="n">G_prime</span><span class="o">.</span><span class="n">to_undirected</span><span class="p">()))</span>
    <span class="k">def</span> <span class="nf">gc_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">layer</span><span class="p">):</span>
        <span class="n">G_prime_nodes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">net_id</span> <span class="o">==</span> <span class="n">layer</span> <span class="ow">and</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="o">==</span><span class="mf">1.0</span><span class="p">]</span>
        <span class="n">G_prime</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">G_prime_nodes</span><span class="p">))</span>
        <span class="n">G_prime</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">([(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">G_prime</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="o">==</span><span class="mf">0.0</span><span class="p">])</span>
        <span class="n">cc</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(</span><span class="n">G_prime</span><span class="o">.</span><span class="n">to_undirected</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">cc</span><span class="p">:</span>
            <span class="c1">#if len(list(cc)) == 1:</span>
            <span class="c1">#    print &quot;I&#39;m here&quot;</span>
            <span class="c1">#    return len(list(cc)[0])</span>
            <span class="c1">#cc_list=list(cc)</span>
            <span class="c1">#print &quot;Length&quot;,len(cc_list)</span>
            <span class="c1">#if len(cc_list) == 1:</span>
            <span class="c1">#    return len(cc_list[0])</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
<div class="viewcode-block" id="InfrastructureNetwork.to_gamefile"><a class="viewcode-back" href="../infrastructure.html#infrastructure.InfrastructureNetwork.to_gamefile">[docs]</a>    <span class="k">def</span> <span class="nf">to_gamefile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">layers</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot; Used for multidefender security games.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../results/indp_gamefile.game&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">num_players</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span>
            <span class="n">num_targets</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">net_id</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">])</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">num_players</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">num_targets</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,2</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">layers</span><span class="p">)):</span>
                <span class="n">layer_nodes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">net_id</span><span class="o">==</span><span class="n">layers</span><span class="p">[</span><span class="n">layer</span><span class="p">]]</span>
                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">layer_nodes</span><span class="p">:</span>
                    <span class="n">def_values</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span>
                    <span class="n">def_values</span><span class="p">[</span><span class="n">layer</span><span class="p">]</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">demand</span><span class="p">)</span>
                    <span class="n">atk_values</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">def_values</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="c1"># f.write(&quot;0.0,1.0&quot;)</span>
                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">def_values</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">atk_values</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>
                    
    <span class="k">def</span> <span class="nf">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">layers</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;infrastructure_adj.csv&quot;</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>
                            

<span class="k">def</span> <span class="nf">load_sample</span><span class="p">():</span>
    <span class="n">G</span><span class="o">=</span><span class="n">InfrastructureNetwork</span><span class="p">(</span><span class="s2">&quot;Sample&quot;</span><span class="p">)</span>
    <span class="n">node_dict</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span> <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span> <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mf">1.0</span><span class="p">],</span> <span class="mi">4</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]},</span> 
               <span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="mi">5</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mf">1.0</span><span class="p">],</span> <span class="mi">6</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span> <span class="mi">7</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span> <span class="mi">8</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]}}</span>
    <span class="n">arc_dict</span><span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)],</span> <span class="mi">2</span><span class="p">:</span> <span class="p">[(</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">)]}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">nodes</span> <span class="ow">in</span> <span class="n">node_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">node</span><span class="p">,</span><span class="n">vals</span> <span class="ow">in</span> <span class="n">nodes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">n</span><span class="o">=</span><span class="n">InfrastructureNode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">node</span><span class="p">)</span>
            <span class="n">n</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">n</span><span class="o">.</span><span class="n">repaired</span><span class="o">=</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">n</span><span class="o">.</span><span class="n">reconstruction_cost</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">n</span><span class="o">.</span><span class="n">oversupply_penalty</span><span class="o">=</span><span class="mi">100</span>
            <span class="n">n</span><span class="o">.</span><span class="n">undersupply_penalty</span><span class="o">=</span><span class="mi">100</span>
            <span class="n">n</span><span class="o">.</span><span class="n">demand</span><span class="o">=</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">n</span><span class="o">.</span><span class="n">space</span><span class="o">=</span><span class="p">((</span><span class="n">node</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">n</span><span class="o">.</span><span class="n">resource_usage</span><span class="o">=</span><span class="mi">1</span> 
            <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">((</span><span class="n">node</span><span class="p">,</span><span class="n">key</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;inf_data&#39;</span><span class="p">:</span><span class="n">n</span><span class="p">})</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">arcs</span> <span class="ow">in</span> <span class="n">arc_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">arc</span> <span class="ow">in</span> <span class="n">arcs</span><span class="p">:</span>
            <span class="n">a</span><span class="o">=</span><span class="n">InfrastructureArc</span><span class="p">(</span><span class="n">arc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">arc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">key</span><span class="p">)</span>
            <span class="n">a</span><span class="o">.</span><span class="n">flow_cost</span><span class="o">=</span><span class="mf">1.0</span>
            <span class="n">a</span><span class="o">.</span><span class="n">capacity</span><span class="o">=</span><span class="mf">20.0</span>
            <span class="n">a</span><span class="o">.</span><span class="n">space</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="n">arc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">key</span><span class="p">),(</span><span class="n">arc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">key</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;inf_data&#39;</span><span class="p">:</span><span class="n">a</span><span class="p">})</span>
    <span class="n">a1</span><span class="o">=</span><span class="n">InfrastructureInterdepArc</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;inf_data&#39;</span><span class="p">:</span><span class="n">a1</span><span class="p">})</span>
    <span class="c1">#a2=InfrastructureInterdepArc(8,4,2,1,1.0)</span>
    <span class="c1">#G.G.add_edge((8,2),(4,1),data={&#39;inf_data&#39;:a2})</span>
    <span class="c1">#a3=InfrastructureInterdepArc(2,6,1,2,1.0)</span>
    <span class="c1">#G.G.add_edge((2,1),(6,2),data={&#39;inf_data&#39;:a3})</span>
    <span class="n">a2</span><span class="o">=</span><span class="n">InfrastructureInterdepArc</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;inf_data&#39;</span><span class="p">:</span><span class="n">a2</span><span class="p">})</span>
    <span class="n">a3</span><span class="o">=</span><span class="n">InfrastructureInterdepArc</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;inf_data&#39;</span><span class="p">:</span><span class="n">a3</span><span class="p">})</span>
    <span class="n">a4</span><span class="o">=</span><span class="n">InfrastructureInterdepArc</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;inf_data&#39;</span><span class="p">:</span><span class="n">a4</span><span class="p">})</span>
    <span class="n">G</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">InfrastructureSpace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.0</span><span class="p">))</span>
    <span class="n">G</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">InfrastructureSpace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.0</span><span class="p">))</span>
    <span class="n">G</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">InfrastructureSpace</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mf">0.0</span><span class="p">))</span>
    <span class="n">G</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">InfrastructureSpace</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mf">0.0</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">G</span>

<span class="k">def</span> <span class="nf">load_percolation_model</span><span class="p">(</span><span class="n">supply_net</span><span class="p">):</span>
    <span class="n">G</span><span class="o">=</span><span class="n">InfrastructureNetwork</span><span class="p">(</span><span class="s2">&quot;PercolationModel&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="n">supply_net</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">n</span><span class="o">=</span><span class="n">InfrastructureNode</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
        <span class="n">n</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="n">n</span><span class="o">.</span><span class="n">repaired</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="n">n</span><span class="o">.</span><span class="n">reconstruction_cost</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">supply</span><span class="p">)</span>
        <span class="n">n</span><span class="o">.</span><span class="n">oversupply_penalty</span><span class="o">=</span><span class="mi">100</span>
        <span class="n">n</span><span class="o">.</span><span class="n">undersupply_penalty</span><span class="o">=</span><span class="mi">100</span>
        <span class="n">n</span><span class="o">.</span><span class="n">demand</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">supply</span>
        <span class="n">n</span><span class="o">.</span><span class="n">space</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">n</span><span class="o">.</span><span class="n">resource_usage</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;inf_data&#39;</span><span class="p">:</span><span class="n">n</span><span class="p">})</span>
    <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="n">supply_net</span><span class="o">.</span><span class="n">N_c</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">a</span><span class="o">=</span><span class="n">InfrastructureArc</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">flow_cost</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">a</span><span class="o">.</span><span class="n">capacity</span><span class="o">=</span><span class="mf">100000.0</span>
        <span class="n">a</span><span class="o">.</span><span class="n">space</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">a</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">a</span><span class="o">.</span><span class="n">repaired</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">a</span><span class="o">.</span><span class="n">resource_usage</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="n">a</span><span class="o">.</span><span class="n">reconstruction_cost</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="n">u</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="n">v</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;inf_data&#39;</span><span class="p">:</span><span class="n">a</span><span class="p">})</span>
        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="n">v</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="n">u</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;inf_data&#39;</span><span class="p">:</span><span class="n">a</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">G</span>

<span class="k">def</span> <span class="nf">load_infrastructure_data</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="o">=</span><span class="s2">&quot;../data/INDP_7-20-2015/&quot;</span><span class="p">,</span><span class="n">external_interdependency_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">magnitude</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">sim_number</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">cost_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="k">if</span> <span class="s2">&quot;INDP_7-20-2015&quot;</span> <span class="ow">in</span> <span class="n">BASE_DIR</span><span class="p">:</span>
<span class="c1">#        print &quot;Loading a network..&quot; #!!!</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">load_infrastructure_array_format</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="o">=</span><span class="n">BASE_DIR</span><span class="p">,</span><span class="n">external_interdependency_dir</span><span class="o">=</span><span class="n">external_interdependency_dir</span><span class="p">,</span><span class="n">magnitude</span><span class="o">=</span><span class="n">magnitude</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="p">,</span><span class="n">sim_number</span><span class="o">=</span><span class="n">sim_number</span><span class="p">,</span><span class="n">cost_scale</span><span class="o">=</span><span class="n">cost_scale</span><span class="p">)</span>
<span class="c1">#        print G #!!!</span>
        <span class="k">return</span> <span class="n">G</span>
    <span class="k">if</span> <span class="s2">&quot;Extended_Shelby_County&quot;</span> <span class="ow">in</span> <span class="n">BASE_DIR</span><span class="p">:</span>
<span class="c1">#        print &quot;Loading a network..&quot; #!!!</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">load_infrastructure_array_format_extended</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="o">=</span><span class="n">BASE_DIR</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="p">,</span><span class="n">sim_number</span><span class="o">=</span><span class="n">sim_number</span><span class="p">,</span><span class="n">cost_scale</span><span class="o">=</span><span class="n">cost_scale</span><span class="p">)</span>
<span class="c1">#        print G #!!!</span>
        <span class="k">return</span> <span class="n">G</span>        
        
    <span class="c1">#elif BASE_DIR == &quot;../data/INDP_4-12-2016&quot;:</span>
    <span class="c1">#    load_infrastructure_csv_format(BASE_DIR=BASE_DIR,external_interdependency_dir=external_interdependency_dir,magnitude=magnitude,v=v,sim_number=sim_number,cost_scale=cost_scale)</span>

<span class="k">def</span> <span class="nf">load_interdependencies</span><span class="p">(</span><span class="n">netnumber</span><span class="p">,</span><span class="n">src_netnumber</span><span class="p">,</span><span class="n">BASE_DIR</span><span class="o">=</span><span class="s2">&quot;../data/INDP_4-12-2016&quot;</span><span class="p">):</span>
    <span class="c1"># Variables in CSV format is broken into files:</span>
	<span class="c1"># S&lt;netnumber&gt;_adj : Adjacency matrix for &lt;netnumber&gt;</span>
	<span class="c1"># S&lt;netnumber&gt;_bal : demand/supply of node.</span>
	<span class="c1"># S&lt;netnumber&gt;_cst : flow cost ?</span>
	<span class="c1"># S&lt;netnumber&gt;_dset : Set of distributors (but this can be calculated with *_bal)</span>
	<span class="c1"># S&lt;netnumber&gt;_gset : Set of generators (but this can be calculated with *_bal)</span>
	<span class="c1"># S&lt;netnumber&gt;_ub  : Upper bound on arc capacity.</span>
	<span class="c1"># S&lt;netnumber&gt;_lb  : Lower bound on arc capacity (typically 0).</span>
	<span class="c1"># S&lt;netnumber&gt;_imt : Interdependency matrix for network &lt;netnumber&gt;. &lt;=== This method will only load interdependencies.</span>
    <span class="n">arcs</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="o">+</span><span class="s2">&quot;/csv/S&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">netnumber</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;_imt.csv&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">rows</span><span class="o">=</span><span class="p">[[</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
                <span class="k">if</span> <span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">arc</span><span class="o">=</span><span class="n">InfrastructureInterdepArc</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">src_netnumber</span><span class="p">,</span><span class="n">netnumber</span><span class="p">,</span><span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                    <span class="n">arcs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">arcs</span>
                    
<span class="k">def</span> <span class="nf">load_infrastructure_array_format</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="o">=</span><span class="s2">&quot;../data/INDP_7-20-2015/&quot;</span><span class="p">,</span><span class="n">external_interdependency_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">magnitude</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">sim_number</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">cost_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="s1">&#39;q&#39;</span><span class="p">,</span><span class="s1">&#39;Mp&#39;</span><span class="p">,</span><span class="s1">&#39;Mm&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="s1">&#39;gamma&#39;</span><span class="p">,</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span><span class="s1">&#39;beta&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;n&#39;</span><span class="p">]</span>
    <span class="n">entry_regex</span><span class="o">=</span>         <span class="sa">r</span><span class="s2">&quot;\(\s*(?P&lt;tuple&gt;(\d+\s*,\s*)*\d+)\s*\)\s*(?P&lt;val&gt;-?\d+)&quot;</span>
    <span class="n">recovery_entry_regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\(\s*(?P&lt;tuple&gt;(\d+\s+)*\d+)\s*\)\s*(?P&lt;val&gt;\d+)&quot;</span>
    <span class="n">var_regex</span><span class="o">=</span>   <span class="sa">r</span><span class="s2">&quot;(?P&lt;varname&gt;\D+):\s*\[(?P&lt;entries&gt;[^\]]*)\]&quot;</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">var_regex</span><span class="p">,</span><span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
    <span class="n">files</span><span class="o">=</span><span class="p">[</span><span class="n">BASE_DIR</span><span class="o">+</span><span class="s2">&quot;/INDP_InputData/MURI_INDP_data.txt&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">sim_number</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="o">+</span><span class="s2">&quot;/Failure and recovery scenarios/recoveryM&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">magnitude</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;v3.txt&quot;</span><span class="p">)</span>
    <span class="nb">vars</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="c1">#            print &quot;Opened&quot;,file,&quot;.&quot;</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">vars_strings</span><span class="o">=</span><span class="p">{}</span>
            <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">pattern</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="n">vars_strings</span><span class="p">[</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;varname&#39;</span><span class="p">))]</span><span class="o">=</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;entries&#39;</span><span class="p">))</span>
<span class="c1">#            print &quot;Varstrings=&quot;,vars_strings.keys()</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vars_strings</span><span class="p">:</span>
                <span class="n">entry_string</span><span class="o">=</span><span class="n">vars_strings</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
                <span class="n">entry_pattern</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">entry_regex</span><span class="p">,</span><span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
                <span class="n">is_match</span><span class="o">=</span><span class="kc">False</span>
                <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">entry_pattern</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">entry_string</span><span class="p">):</span>
                    <span class="n">is_match</span><span class="o">=</span><span class="kc">True</span>
                    <span class="n">tuple_string</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;tuple&#39;</span><span class="p">)</span>
                    <span class="n">val_string</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;val&#39;</span><span class="p">)</span>
                    <span class="n">tuple_string</span><span class="o">=</span><span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">tuple_string</span><span class="p">,</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                    <span class="n">tuple_string</span><span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tuple_string</span><span class="p">]</span>
                    <span class="n">val_string</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">val_string</span><span class="p">))</span>
                    <span class="c1">#print v,&quot;:&quot;,tuple_string,&quot;=&gt;&quot;,val_string</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">:</span>
                        <span class="nb">vars</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
                    <span class="nb">vars</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tuple_string</span><span class="p">,</span><span class="n">val_string</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_match</span><span class="p">:</span>
                    <span class="n">recovery_pattern</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">recovery_entry_regex</span><span class="p">,</span><span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">recovery_pattern</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">entry_string</span><span class="p">):</span>
                        <span class="n">is_match</span><span class="o">=</span><span class="kc">True</span>
                        <span class="n">tuple_string</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;tuple&#39;</span><span class="p">)</span>
                        <span class="n">val_string</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;val&#39;</span><span class="p">)</span>
                        <span class="n">tuple_string</span><span class="o">=</span><span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">tuple_string</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                        <span class="n">tuple_string</span><span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tuple_string</span><span class="p">]</span>
                        <span class="n">val_string</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">val_string</span><span class="p">))</span>
                        <span class="c1">#print v,&quot;:&quot;,tuple_string,&quot;=&gt;&quot;,val_string</span>
                        <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">:</span>
                            <span class="nb">vars</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
                        <span class="nb">vars</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tuple_string</span><span class="p">,</span><span class="n">val_string</span><span class="p">))</span>
    <span class="n">G</span><span class="o">=</span><span class="n">InfrastructureNetwork</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
    <span class="n">global_index</span><span class="o">=</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]:</span>
        <span class="n">n</span><span class="o">=</span><span class="n">InfrastructureNode</span><span class="p">(</span><span class="n">global_index</span><span class="p">,</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1">#print &quot;Adding node&quot;,node[0][0],&quot;in layer&quot;,node[0][1],&quot;.&quot;</span>
        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">((</span><span class="n">n</span><span class="o">.</span><span class="n">local_id</span><span class="p">,</span><span class="n">n</span><span class="o">.</span><span class="n">net_id</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;inf_data&#39;</span><span class="p">:</span><span class="n">n</span><span class="p">})</span>
        <span class="n">global_index</span><span class="o">+=</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">arc</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]:</span>
        <span class="n">a</span><span class="o">=</span><span class="n">InfrastructureArc</span><span class="p">(</span><span class="n">arc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">arc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">arc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> 
        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">source</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">layer</span><span class="p">),(</span><span class="n">a</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">layer</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;inf_data&#39;</span><span class="p">:</span><span class="n">a</span><span class="p">})</span>
    <span class="k">if</span> <span class="n">external_interdependency_dir</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Loading external interdependencies...&quot;</span><span class="p">)</span>
        <span class="n">interdep_arcs</span><span class="o">=</span><span class="n">load_interdependencies</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">BASE_DIR</span><span class="o">=</span><span class="n">external_interdependency_dir</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">interdep_arcs</span><span class="p">:</span>
            <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">source</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">source_layer</span><span class="p">),(</span><span class="n">a</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">dest_layer</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;inf_data&#39;</span><span class="p">:</span><span class="n">a</span><span class="p">})</span>
        <span class="n">interdep_arcs</span><span class="o">=</span><span class="n">load_interdependencies</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">BASE_DIR</span><span class="o">=</span><span class="n">external_interdependency_dir</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">interdep_arcs</span><span class="p">:</span>
            <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">source</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">source_layer</span><span class="p">),(</span><span class="n">a</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">dest_layer</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;inf_data&#39;</span><span class="p">:</span><span class="n">a</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">arc</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="p">]:</span>
            <span class="n">gamma</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">arc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">gamma</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">a</span><span class="o">=</span><span class="n">InfrastructureInterdepArc</span><span class="p">(</span><span class="n">arc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">arc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">arc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="n">arc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span><span class="n">gamma</span><span class="p">)</span>
                <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">source</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">source_layer</span><span class="p">),(</span><span class="n">a</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">dest_layer</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;inf_data&#39;</span><span class="p">:</span><span class="n">a</span><span class="p">})</span>
    <span class="c1"># Arc Attributes.</span>
    <span class="k">for</span> <span class="n">flow_cost</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]:</span>
        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="n">flow_cost</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">flow_cost</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])][(</span><span class="n">flow_cost</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">flow_cost</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flow_cost</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">flow_cost</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">cost_scale</span>
    <span class="k">for</span> <span class="n">rec_cost</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]:</span>
        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="n">rec_cost</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">rec_cost</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])][(</span><span class="n">rec_cost</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">rec_cost</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reconstruction_cost</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">rec_cost</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">cost_scale</span>
    <span class="k">for</span> <span class="n">cap</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]:</span>
        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="n">cap</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">cap</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])][(</span><span class="n">cap</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">cap</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">capacity</span><span class="o">=</span><span class="n">cap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]:</span>
        <span class="c1"># Assume only one kind of resource for now.</span>
        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])][(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resource_usage</span><span class="o">=</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># Space attributes.</span>
    <span class="k">for</span> <span class="n">space</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]:</span>
        <span class="n">G</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">InfrastructureSpace</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">space</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">space</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
    <span class="k">for</span> <span class="n">space</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]:</span>
        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="n">space</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">space</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])][(</span><span class="n">space</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">space</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">space</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">space</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">space</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]:</span>
        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">node</span><span class="p">[(</span><span class="n">space</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">space</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">space</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">space</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
    <span class="c1"># Node Attributes.</span>
    <span class="k">for</span> <span class="n">rec_cost</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">]:</span>
        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">node</span><span class="p">[(</span><span class="n">rec_cost</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">rec_cost</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reconstruction_cost</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">rec_cost</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">cost_scale</span>
    <span class="k">for</span> <span class="n">sup</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">[</span><span class="s1">&#39;Mp&#39;</span><span class="p">]:</span>
        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">node</span><span class="p">[(</span><span class="n">sup</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">sup</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">oversupply_penalty</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">sup</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">cost_scale</span>
    <span class="k">for</span> <span class="n">sup</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">[</span><span class="s1">&#39;Mm&#39;</span><span class="p">]:</span>
        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">node</span><span class="p">[(</span><span class="n">sup</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">sup</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">undersupply_penalty</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">sup</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">cost_scale</span>
    <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]:</span>
        <span class="c1"># Assume only one kind of resource for now.</span>
        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">node</span><span class="p">[(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resource_usage</span><span class="o">=</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">dem</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]:</span>
        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">node</span><span class="p">[(</span><span class="n">dem</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">dem</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">demand</span><span class="o">=</span><span class="n">dem</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Load failure scenarios.</span>
    <span class="k">if</span> <span class="n">sim_number</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">[</span><span class="s1">&#39;nresults&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">sim_number</span><span class="p">:</span>
                <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">node</span><span class="p">[(</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">node</span><span class="p">[(</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">repaired</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1">#if float(func[1]) == 0.0:</span>
                <span class="c1">#    print &quot;Node (&quot;,`func[0][1]`+&quot;,&quot;+`func[0][2]`+&quot;) broken.&quot;</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">[</span><span class="s1">&#39;aresults&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">sim_number</span><span class="p">:</span>
                <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])][(</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])][(</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">repaired</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1">#if float(func[1]) == 0.0:</span>
                <span class="c1">#    print &quot;Arc ((&quot;,`func[0][1]`+&quot;,&quot;+`func[0][3]`+&quot;),(&quot;+`func[0][2]`+&quot;,&quot;+`func[0][3]`+&quot;)) broken.&quot;</span>
    <span class="k">return</span> <span class="n">G</span>
               
<span class="k">def</span> <span class="nf">load_infrastructure_array_format_extended</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="o">=</span><span class="s2">&quot;../data/Extended_Shelby_County/&quot;</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">sim_number</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">cost_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="n">f</span><span class="p">))]</span>
    <span class="n">netNames</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Water&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;Gas&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Power&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;Telecommunication&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">}</span>
    <span class="n">G</span><span class="o">=</span><span class="n">InfrastructureNetwork</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
    <span class="n">global_index</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> 
        <span class="k">if</span> <span class="n">fname</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span><span class="o">==</span><span class="s1">&#39;Nodes&#39;</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="o">+</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="c1">#                print &quot;Opened&quot;,file,&quot;.&quot;</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                <span class="n">net</span> <span class="o">=</span> <span class="n">netNames</span><span class="p">[</span><span class="n">fname</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">]]</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>               
                    <span class="n">n</span><span class="o">=</span><span class="n">InfrastructureNode</span><span class="p">(</span><span class="n">global_index</span><span class="p">,</span><span class="n">net</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;ID&#39;</span><span class="p">]))</span>
                    <span class="c1">#print &quot;Adding node&quot;,node[0][0],&quot;in layer&quot;,node[0][1],&quot;.&quot;</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">((</span><span class="n">n</span><span class="o">.</span><span class="n">local_id</span><span class="p">,</span><span class="n">n</span><span class="o">.</span><span class="n">net_id</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;inf_data&#39;</span><span class="p">:</span><span class="n">n</span><span class="p">})</span>
                    <span class="n">global_index</span><span class="o">+=</span><span class="mi">1</span>                    
                    <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[(</span><span class="n">n</span><span class="o">.</span><span class="n">local_id</span><span class="p">,</span><span class="n">n</span><span class="o">.</span><span class="n">net_id</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reconstruction_cost</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;q (complete DS)&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">cost_scale</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[(</span><span class="n">n</span><span class="o">.</span><span class="n">local_id</span><span class="p">,</span><span class="n">n</span><span class="o">.</span><span class="n">net_id</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">oversupply_penalty</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Mp&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">cost_scale</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[(</span><span class="n">n</span><span class="o">.</span><span class="n">local_id</span><span class="p">,</span><span class="n">n</span><span class="o">.</span><span class="n">net_id</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">undersupply_penalty</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Mm&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">cost_scale</span>
                    <span class="c1"># Assume only one kind of resource for now and one resource for each repaired element.</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[(</span><span class="n">n</span><span class="o">.</span><span class="n">local_id</span><span class="p">,</span><span class="n">n</span><span class="o">.</span><span class="n">net_id</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resource_usage</span><span class="o">=</span><span class="mi">1</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[(</span><span class="n">n</span><span class="o">.</span><span class="n">local_id</span><span class="p">,</span><span class="n">n</span><span class="o">.</span><span class="n">net_id</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">demand</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Demand&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> 
        <span class="k">if</span> <span class="n">fname</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">==</span><span class="s1">&#39;Arcs&#39;</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="o">+</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="c1">#                print &quot;Opened&quot;,file,&quot;.&quot;</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                <span class="n">net</span> <span class="o">=</span> <span class="n">netNames</span><span class="p">[</span><span class="n">fname</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]]</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>  
                    <span class="k">for</span> <span class="n">duplicate</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">duplicate</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                            <span class="n">a</span><span class="o">=</span><span class="n">InfrastructureArc</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Start Node&#39;</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;End Node&#39;</span><span class="p">]),</span><span class="n">net</span><span class="p">)</span> 
                        <span class="k">elif</span> <span class="n">duplicate</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">a</span><span class="o">=</span><span class="n">InfrastructureArc</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;End Node&#39;</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Start Node&#39;</span><span class="p">]),</span><span class="n">net</span><span class="p">)</span> 
                        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">source</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">layer</span><span class="p">),(</span><span class="n">a</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">layer</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;inf_data&#39;</span><span class="p">:</span><span class="n">a</span><span class="p">})</span>
                        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="n">a</span><span class="o">.</span><span class="n">source</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">layer</span><span class="p">)][(</span><span class="n">a</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">layer</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flow_cost</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;c&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">cost_scale</span>
                        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="n">a</span><span class="o">.</span><span class="n">source</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">layer</span><span class="p">)][(</span><span class="n">a</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">layer</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reconstruction_cost</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;f&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">cost_scale</span>
                        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="n">a</span><span class="o">.</span><span class="n">source</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">layer</span><span class="p">)][(</span><span class="n">a</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">layer</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">capacity</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;u&#39;</span><span class="p">])</span>
                        <span class="c1"># Assume only one kind of resource for now and one resource for each repaired element.</span>
                        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="n">a</span><span class="o">.</span><span class="n">source</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">layer</span><span class="p">)][(</span><span class="n">a</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">layer</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resource_usage</span><span class="o">=</span><span class="mi">1</span>   

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="o">+</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="c1">#            print &quot;Opened&quot;,file,&quot;.&quot;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">fname</span><span class="o">==</span><span class="s1">&#39;beta&#39;</span><span class="p">:</span>
                    <span class="n">net</span> <span class="o">=</span> <span class="n">netNames</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Network&#39;</span><span class="p">]]</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Start Node&#39;</span><span class="p">]),</span><span class="n">net</span><span class="p">)][(</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;End Node&#39;</span><span class="p">]),</span><span class="n">net</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">space</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Subspace&#39;</span><span class="p">]))</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;End Node&#39;</span><span class="p">]),</span><span class="n">net</span><span class="p">)][(</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Start Node&#39;</span><span class="p">]),</span><span class="n">net</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">space</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Subspace&#39;</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">fname</span><span class="o">==</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span>
                    <span class="n">net</span> <span class="o">=</span> <span class="n">netNames</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Network&#39;</span><span class="p">]]</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">node</span><span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;ID&#39;</span><span class="p">]),</span><span class="n">net</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">space</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Subspace&#39;</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">fname</span><span class="o">==</span><span class="s1">&#39;g&#39;</span><span class="p">:</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">InfrastructureSpace</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Subspace_ID&#39;</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;g&#39;</span><span class="p">])))</span>       
                <span class="k">if</span> <span class="n">fname</span><span class="o">==</span><span class="s1">&#39;Interdep&#39;</span> <span class="ow">and</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Physical&#39;</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Dependee Node&#39;</span><span class="p">])</span>
                    <span class="n">net_i</span> <span class="o">=</span> <span class="n">netNames</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Dependee Network&#39;</span><span class="p">]]</span>
                    <span class="n">j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Depender Node&#39;</span><span class="p">])</span>
                    <span class="n">net_j</span> <span class="o">=</span> <span class="n">netNames</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Depender Network&#39;</span><span class="p">]]</span>
                    <span class="n">a</span><span class="o">=</span><span class="n">InfrastructureInterdepArc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">net_i</span><span class="p">,</span><span class="n">net_j</span><span class="p">,</span><span class="n">gamma</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">source</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">source_layer</span><span class="p">),(</span><span class="n">a</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">dest_layer</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;inf_data&#39;</span><span class="p">:</span><span class="n">a</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">G</span>

<span class="k">def</span> <span class="nf">add_failure_scenario</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">DAM_DIR</span><span class="o">=</span><span class="s2">&quot;../data/INDP_7-20-2015/&quot;</span><span class="p">,</span><span class="n">magnitude</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">sim_number</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Initiallize Damage...&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sim_number</span> <span class="o">==</span> <span class="s2">&quot;INF&quot;</span><span class="p">:</span>
        <span class="c1"># Destory all nodes!!!!</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="mf">0.0</span>
            <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">repaired</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_interdep</span><span class="p">:</span>
                <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">v</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">v</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">repaired</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">elif</span> <span class="n">sim_number</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="s1">&#39;q&#39;</span><span class="p">,</span><span class="s1">&#39;Mp&#39;</span><span class="p">,</span><span class="s1">&#39;Mm&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="s1">&#39;gamma&#39;</span><span class="p">,</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span><span class="s1">&#39;beta&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;n&#39;</span><span class="p">]</span>
        <span class="n">entry_regex</span><span class="o">=</span>         <span class="sa">r</span><span class="s2">&quot;\(\s*(?P&lt;tuple&gt;(\d+\s*,\s*)*\d)\s*\)\s*(?P&lt;val&gt;-?\d+)&quot;</span>
        <span class="n">recovery_entry_regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\(\s*(?P&lt;tuple&gt;(\d+\s+)*\d)\s*\)\s*(?P&lt;val&gt;\d+)&quot;</span>
        <span class="n">var_regex</span><span class="o">=</span>   <span class="sa">r</span><span class="s2">&quot;(?P&lt;varname&gt;\D+):\s*\[(?P&lt;entries&gt;[^\]]*)\]&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">var_regex</span><span class="p">,</span><span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">DAM_DIR</span><span class="o">+</span><span class="s2">&quot;/Failure and recovery scenarios/recoveryM&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">magnitude</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;v3.txt&quot;</span>
        <span class="nb">vars</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="c1">#print &quot;Opened&quot;,file,&quot;.&quot;                                                                                                      xs                              </span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">vars_strings</span><span class="o">=</span><span class="p">{}</span>
            <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">pattern</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="n">vars_strings</span><span class="p">[</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;varname&#39;</span><span class="p">))]</span><span class="o">=</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;entries&#39;</span><span class="p">))</span>
            <span class="c1">#print &quot;Varstrings=&quot;,vars_strings.keys()                                                                                                            </span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vars_strings</span><span class="p">:</span>
                <span class="n">entry_string</span><span class="o">=</span><span class="n">vars_strings</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
                <span class="n">entry_pattern</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">entry_regex</span><span class="p">,</span><span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
                <span class="n">is_match</span><span class="o">=</span><span class="kc">False</span>
                <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">entry_pattern</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">entry_string</span><span class="p">):</span>
                    <span class="n">is_match</span><span class="o">=</span><span class="kc">True</span>
                    <span class="n">tuple_string</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;tuple&#39;</span><span class="p">)</span>
                    <span class="n">val_string</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;val&#39;</span><span class="p">)</span>
                    <span class="n">tuple_string</span><span class="o">=</span><span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">tuple_string</span><span class="p">,</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                    <span class="n">tuple_string</span><span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tuple_string</span><span class="p">]</span>
                    <span class="n">val_string</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">val_string</span><span class="p">))</span>
                    <span class="c1">#print v,&quot;:&quot;,tuple_string,&quot;=&gt;&quot;,val_string                                                                                                         </span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">:</span>
                        <span class="nb">vars</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
                    <span class="nb">vars</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tuple_string</span><span class="p">,</span><span class="n">val_string</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_match</span><span class="p">:</span>
                    <span class="n">recovery_pattern</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">recovery_entry_regex</span><span class="p">,</span><span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">recovery_pattern</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">entry_string</span><span class="p">):</span>
                        <span class="n">is_match</span><span class="o">=</span><span class="kc">True</span>
                        <span class="n">tuple_string</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;tuple&#39;</span><span class="p">)</span>
                        <span class="n">val_string</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;val&#39;</span><span class="p">)</span>
                        <span class="n">tuple_string</span><span class="o">=</span><span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">tuple_string</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                        <span class="n">tuple_string</span><span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tuple_string</span><span class="p">]</span>
                        <span class="n">val_string</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">val_string</span><span class="p">))</span>
                        <span class="c1">#print v,&quot;:&quot;,tuple_string,&quot;=&gt;&quot;,val_string</span>
                        <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">:</span>
                            <span class="nb">vars</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
                        <span class="nb">vars</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tuple_string</span><span class="p">,</span><span class="n">val_string</span><span class="p">))</span>
        <span class="c1"># Load failure scenarios.</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">[</span><span class="s1">&#39;nresults&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">sim_number</span><span class="p">:</span>
                <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">node</span><span class="p">[(</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">node</span><span class="p">[(</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">repaired</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1">#if float(func[1]) == 0.0:</span>
                <span class="c1">#    print &quot;Node (&quot;,`func[0][1]`+&quot;,&quot;+`func[0][2]`+&quot;) broken.&quot;</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">[</span><span class="s1">&#39;aresults&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">sim_number</span><span class="p">:</span>
                <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])][(</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])][(</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">repaired</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1">#if float(func[1]) == 0.0:</span>
                <span class="c1">#    print &quot;Arc ((&quot;,`func[0][1]`+&quot;,&quot;+`func[0][3]`+&quot;),(&quot;+`func[0][2]`+&quot;,&quot;+`func[0][3]`+&quot;)) broken.&quot;</span>

<span class="k">def</span> <span class="nf">add_random_failure_scenario</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">sample</span><span class="p">,</span><span class="n">config</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">DAM_DIR</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">csv</span>
    <span class="c1"># print(&quot;Initiallize Random Damage...&quot;)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">DAM_DIR</span><span class="o">+</span><span class="s1">&#39;Initial_node.csv&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">rawN</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">rawN</span> <span class="o">=</span> <span class="n">rawN</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">rawN</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; )(&#39;</span><span class="p">)),</span><span class="nb">int</span><span class="p">(</span><span class="n">rawN</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; )(&#39;</span><span class="p">)))</span>
            <span class="n">state</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">sample</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="n">state</span>
            <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">repaired</span><span class="o">=</span><span class="n">state</span>
            
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">DAM_DIR</span><span class="o">+</span><span class="s1">&#39;Initial_links.csv&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">rawUV</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">rawUV</span> <span class="o">=</span> <span class="n">rawUV</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">rawUV</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; )(&#39;</span><span class="p">)),</span><span class="nb">int</span><span class="p">(</span><span class="n">rawUV</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; )(&#39;</span><span class="p">)))</span>
            <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">rawUV</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; )(&#39;</span><span class="p">)),</span><span class="nb">int</span><span class="p">(</span><span class="n">rawUV</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; )(&#39;</span><span class="p">)))</span>
            <span class="n">state</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">sample</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">state</span><span class="o">==</span><span class="mf">0.0</span><span class="p">:</span>
                <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">v</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="n">state</span>
                <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">v</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">repaired</span><span class="o">=</span><span class="n">state</span>
            
                <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="n">u</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="n">state</span>
                <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="n">u</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">repaired</span><span class="o">=</span><span class="n">state</span>  
               
<span class="k">def</span> <span class="nf">add_Wu_failure_scenario</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">DAM_DIR</span><span class="o">=</span><span class="s2">&quot;../data/Wu_Scenarios/&quot;</span><span class="p">,</span><span class="n">noSet</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">noSce</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Initiallize Wu failure scenarios...&quot;</span><span class="p">)</span>
    <span class="n">dam_nodes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">dam_arcs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">folderDir</span> <span class="o">=</span> <span class="n">DAM_DIR</span><span class="o">+</span><span class="s1">&#39;Set</span><span class="si">%d</span><span class="s1">/Sce</span><span class="si">%d</span><span class="s1">/&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">noSet</span><span class="p">,</span><span class="n">noSce</span><span class="p">)</span>
    <span class="n">netNames</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s1">&#39;Water&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="s1">&#39;Gas&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="s1">&#39;Power&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">:</span><span class="s1">&#39;Telecommunication&#39;</span><span class="p">}</span>
    <span class="n">ofst</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># set to 1 if node IDs start from 1</span>
    <span class="c1"># Load failure scenarios.</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folderDir</span><span class="p">):</span>  
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">netNames</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">dam_nodes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">folderDir</span><span class="o">+</span>
                                    <span class="s1">&#39;Net_</span><span class="si">%s</span><span class="s1">_Damaged_Nodes.txt&#39;</span> <span class="o">%</span> <span class="n">netNames</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
            <span class="n">dam_arcs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">folderDir</span><span class="o">+</span>
                                    <span class="s1">&#39;Net_</span><span class="si">%s</span><span class="s1">_Damaged_Arcs.txt&#39;</span> <span class="o">%</span> <span class="n">netNames</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>        
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">netNames</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dam_nodes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dam_nodes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">dam_nodes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">dam_nodes</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dam_nodes</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[(</span><span class="n">v</span><span class="o">+</span><span class="n">ofst</span><span class="p">,</span><span class="n">k</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="mf">0.0</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[(</span><span class="n">v</span><span class="o">+</span><span class="n">ofst</span><span class="p">,</span><span class="n">k</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">repaired</span><span class="o">=</span><span class="mf">0.0</span>
<span class="c1">#                    print &quot;Node (&quot;,`v+ofst`+&quot;,&quot;+`k`+&quot;) broken.&quot;</span>
            <span class="k">if</span> <span class="n">dam_arcs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dam_arcs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">dam_arcs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">dam_arcs</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">dam_arcs</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">ofst</span><span class="p">,</span><span class="n">k</span><span class="p">)][(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ofst</span><span class="p">,</span><span class="n">k</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="mf">0.0</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">ofst</span><span class="p">,</span><span class="n">k</span><span class="p">)][(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ofst</span><span class="p">,</span><span class="n">k</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">repaired</span><span class="o">=</span><span class="mf">0.0</span>
<span class="c1">#                    print &quot;Arc ((&quot;,`a[0]+ofst`+&quot;,&quot;+`k`+&quot;),(&quot;+`a[1]+ofst`+&quot;,&quot;+`k`+&quot;)) broken.&quot;</span>
                    
                    <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ofst</span><span class="p">,</span><span class="n">k</span><span class="p">)][(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">ofst</span><span class="p">,</span><span class="n">k</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="mf">0.0</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ofst</span><span class="p">,</span><span class="n">k</span><span class="p">)][(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">ofst</span><span class="p">,</span><span class="n">k</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">repaired</span><span class="o">=</span><span class="mf">0.0</span>
<span class="c1">#                    print &quot;Arc ((&quot;,`a[1]+ofst`+&quot;,&quot;+`k`+&quot;),(&quot;+`a[0]+ofst`+&quot;,&quot;+`k`+&quot;)) broken.&quot;</span>
<span class="c1">#                    </span>
<span class="c1">#        for u,v,a in G.G.edges(data=True):</span>
<span class="c1">#            if a[&#39;data&#39;][&#39;inf_data&#39;].is_interdep:</span>
<span class="c1">#                if G.G.node[u][&#39;data&#39;][&#39;inf_data&#39;].functionality == 0.0:</span>
<span class="c1">#                    G.G.node[v][&#39;data&#39;][&#39;inf_data&#39;].functionality = 0.0</span>
<span class="c1">#                else:</span>
<span class="c1">#                    if G.G.node[v][&#39;data&#39;][&#39;inf_data&#39;].repaired == 1.0:</span>
<span class="c1">#                        G.G.node[v][&#39;data&#39;][&#39;inf_data&#39;].functionality = 1.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span> <span class="c1">#Undamaging scenrios are not presesnted with any file or folder in the datasets      </span>
          
<span class="k">def</span> <span class="nf">load_recovery_scenario</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">action_file</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">action_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">lines</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">data</span><span class="o">=</span><span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">time</span> <span class="o">&lt;=</span> <span class="n">T</span><span class="p">:</span>
                <span class="n">action</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">action</span><span class="p">:</span>
                    <span class="c1"># Edge.</span>
                    <span class="n">edge</span><span class="o">=</span><span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">action</span><span class="p">,</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
                    <span class="n">u</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">v</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">N</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">v</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="mf">1.0</span>
                    <span class="n">N</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">v</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">repaired</span><span class="o">=</span><span class="mf">1.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Node.    </span>
                    <span class="n">node</span><span class="o">=</span><span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">action</span><span class="p">,</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
                    <span class="n">n</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">N</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="mf">1.0</span>
                    <span class="n">N</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">repaired</span><span class="o">=</span><span class="mf">1.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">N</span>

<span class="k">def</span> <span class="nf">compare_results</span><span class="p">(</span><span class="n">strategy_list_string</span><span class="p">,</span><span class="n">BASE_DIR</span><span class="o">=</span><span class="s2">&quot;../data/INDP_7-20-2015/&quot;</span><span class="p">,</span><span class="n">magnitude</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">sim_number</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">sim_number</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="s1">&#39;q&#39;</span><span class="p">,</span><span class="s1">&#39;Mp&#39;</span><span class="p">,</span><span class="s1">&#39;Mm&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="s1">&#39;gamma&#39;</span><span class="p">,</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span><span class="s1">&#39;beta&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;n&#39;</span><span class="p">]</span>
        <span class="n">entry_regex</span><span class="o">=</span>         <span class="sa">r</span><span class="s2">&quot;\(\s*(?P&lt;tuple&gt;(\d+\s*,\s*)*\d)\s*\)\s*(?P&lt;val&gt;-?\d+)&quot;</span>
        <span class="n">recovery_entry_regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\(\s*(?P&lt;tuple&gt;(\d+\s+)*\d)\s*\)\s*(?P&lt;val&gt;\d+)&quot;</span>
        <span class="n">var_regex</span><span class="o">=</span>   <span class="sa">r</span><span class="s2">&quot;(?P&lt;varname&gt;\D+):\s*\[(?P&lt;entries&gt;[^\]]*)\]&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">var_regex</span><span class="p">,</span><span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">BASE_DIR</span><span class="o">+</span><span class="s2">&quot;/Failure and recovery scenarios/recoveryM&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">magnitude</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;v3.txt&quot;</span>
        <span class="nb">vars</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="c1">#print &quot;Opened&quot;,file,&quot;.&quot;                                                                                                      xs                                      </span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">vars_strings</span><span class="o">=</span><span class="p">{}</span>
            <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">pattern</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="n">vars_strings</span><span class="p">[</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;varname&#39;</span><span class="p">))]</span><span class="o">=</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;entries&#39;</span><span class="p">))</span>
            <span class="c1">#print &quot;Varstrings=&quot;,vars_strings.keys()                                                                                                                              </span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vars_strings</span><span class="p">:</span>
                <span class="n">entry_string</span><span class="o">=</span><span class="n">vars_strings</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
                <span class="n">entry_pattern</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">entry_regex</span><span class="p">,</span><span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
                <span class="n">is_match</span><span class="o">=</span><span class="kc">False</span>
                <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">entry_pattern</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">entry_string</span><span class="p">):</span>
                    <span class="n">is_match</span><span class="o">=</span><span class="kc">True</span>
                    <span class="n">tuple_string</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;tuple&#39;</span><span class="p">)</span>
                    <span class="n">val_string</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;val&#39;</span><span class="p">)</span>
                    <span class="n">tuple_string</span><span class="o">=</span><span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">tuple_string</span><span class="p">,</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                    <span class="n">tuple_string</span><span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tuple_string</span><span class="p">]</span>
                    <span class="n">val_string</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">val_string</span><span class="p">))</span>
                    <span class="c1">#print v,&quot;:&quot;,tuple_string,&quot;=&gt;&quot;,val_string                                                                                                                     </span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">:</span>
                        <span class="nb">vars</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
                    <span class="nb">vars</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tuple_string</span><span class="p">,</span><span class="n">val_string</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_match</span><span class="p">:</span>
                    <span class="n">recovery_pattern</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">recovery_entry_regex</span><span class="p">,</span><span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">recovery_pattern</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">entry_string</span><span class="p">):</span>
                        <span class="n">is_match</span><span class="o">=</span><span class="kc">True</span>
                        <span class="n">tuple_string</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;tuple&#39;</span><span class="p">)</span>
                        <span class="n">val_string</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;val&#39;</span><span class="p">)</span>
                        <span class="n">tuple_string</span><span class="o">=</span><span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">tuple_string</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                        <span class="n">tuple_string</span><span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tuple_string</span><span class="p">]</span>
                        <span class="n">val_string</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">val_string</span><span class="p">))</span>
                        <span class="c1">#print v,&quot;:&quot;,tuple_string,&quot;=&gt;&quot;,val_string                                                                                                                 </span>
                        <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">:</span>
                            <span class="nb">vars</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
                        <span class="nb">vars</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tuple_string</span><span class="p">,</span><span class="n">val_string</span><span class="p">))</span>
        <span class="n">repair_dict</span><span class="o">=</span><span class="p">{}</span>
        <span class="c1"># Strategy list string ex: [(13.1)/(21.3,56.3)]-[(34.3)/(45.3)]-[(41)]-[]-[]-[]-[]-[]-[]-[]-[]-[]-[]-[]-[]-[]-[]-[]-[]-[]</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">[</span><span class="s1">&#39;resultsw&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">sim_number</span><span class="p">:</span>
                <span class="n">node_num</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">net_num</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">iteration_repaired</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">iteration_repaired</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">repair_dict</span><span class="p">:</span>
                    <span class="n">repair_dict</span><span class="p">[</span><span class="n">iteration_repaired</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
                <span class="c1">#print &quot;Adding repair:&quot;,node_num,&quot;.&quot;,net_num,&quot;on iteration&quot;,iteration_repaired</span>
                <span class="n">repair_dict</span><span class="p">[</span><span class="n">iteration_repaired</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">node_num</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">net_num</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">[</span><span class="s1">&#39;resultsy&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">sim_number</span><span class="p">:</span>
                <span class="n">src_node</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">dst_node</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">net_num</span> <span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">iteration_repaired</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">iteration_repaired</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">repair_dict</span><span class="p">:</span>
                    <span class="n">repair_dict</span><span class="p">[</span><span class="n">iteration_repaired</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
                <span class="c1">#print &quot;Adding repair&quot;,src_node,&quot;.&quot;,net_num,&quot;=&gt;&quot;,dst_node,&quot;.&quot;,net_num,&quot;on iteration&quot;,iteration_repaired</span>
                <span class="n">repair_dict</span><span class="p">[</span><span class="n">iteration_repaired</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">src_nodeum</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">net_num</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">dst_node</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">net_num</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
        <span class="n">it_array</span><span class="o">=</span><span class="n">repair_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">it_array</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">strat_list_array</span><span class="o">=</span><span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">strategy_list_string</span><span class="p">,</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="n">strat_list_array</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">strat_list_array</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">repair_dict</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">strat_list_array</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">it_array</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">strat_list_array</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">s</span><span class="p">:</span>
                <span class="n">real_strats</span><span class="o">=</span><span class="n">repair_dict</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
                <span class="n">comp_strats</span><span class="o">=</span><span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">strat_list_array</span><span class="p">[</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">real_strats</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">r</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">comp_strats</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">comp_strats</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">r</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">real_strats</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
                


<span class="k">def</span> <span class="nf">count_interdependencies</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">interdep_dict</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">:{</span><span class="mi">2</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span><span class="mi">2</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span><span class="mi">3</span><span class="p">:{</span><span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">0</span><span class="p">}}</span>
    <span class="n">total_interdeps</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">N</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_interdep</span><span class="p">:</span>
            <span class="n">total_interdeps</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">src_layer</span><span class="o">=</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">dst_layer</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="s2">&quot;=&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">interdep_dict</span><span class="p">[</span><span class="n">dst_layer</span><span class="p">][</span><span class="n">src_layer</span><span class="p">]</span><span class="o">=</span><span class="n">interdep_dict</span><span class="p">[</span><span class="n">dst_layer</span><span class="p">][</span><span class="n">src_layer</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
            <span class="c1">#if N.G.node[u][&#39;data&#39;][&#39;inf_data&#39;].demand &gt;= 0:</span>
            <span class="c1">#    print &quot;...is supply node&quot;</span>
            <span class="c1">#else:</span>
            <span class="c1">#    print &quot;I&#39;m demanding&quot;,N.G.node[u][&#39;data&#39;][&#39;inf_data&#39;].demand</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Total Interdependencies =&quot;</span><span class="p">,</span><span class="n">total_interdeps</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Layer 1 (Water) dependencies on Layer 2 (Gas) =  &quot;</span><span class="p">,</span><span class="n">interdep_dict</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Layer 1 (Water) dependencies on Layer 3 (Power) =&quot;</span><span class="p">,</span><span class="n">interdep_dict</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Layer 2 (Gas) dependencies on Layer 1 (Water)   =&quot;</span><span class="p">,</span><span class="n">interdep_dict</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Layer 2 (Gas) dependencies on Layer 3 (Power)   =&quot;</span><span class="p">,</span><span class="n">interdep_dict</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Layer 3 (Power) dependencies on Layer 1 (Water) =&quot;</span><span class="p">,</span><span class="n">interdep_dict</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Layer 3 (Power) dependencies on Layer 2 (Gas)   =&quot;</span><span class="p">,</span><span class="n">interdep_dict</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">count_supply</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">layer_id</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">total_supply</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="n">total_demand</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="n">N</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">layer_id</span><span class="p">:</span>
            <span class="n">demand</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">demand</span>
            <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Demand for node&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="s2">&quot;=&quot;</span><span class="p">,</span><span class="n">demand</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">demand</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">total_demand</span><span class="o">+=-</span><span class="n">demand</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">total_supply</span><span class="o">+=</span><span class="n">demand</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Total supply for Layer&quot;</span><span class="p">,</span><span class="n">layer_id</span><span class="p">,</span><span class="s2">&quot;=&quot;</span><span class="p">,</span><span class="n">total_supply</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Total demand for Layer&quot;</span><span class="p">,</span><span class="n">layer_id</span><span class="p">,</span><span class="s2">&quot;=&quot;</span><span class="p">,</span><span class="n">total_demand</span><span class="p">)</span>
            
<span class="k">def</span> <span class="nf">count_nodes</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">layer_id</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">num_nodes</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="n">N</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">layer_id</span><span class="p">])</span>
    <span class="n">num_arcs</span><span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">u</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">N</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">layer_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_interdep</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Nodes in Layer&quot;</span><span class="p">,</span><span class="n">layer_id</span><span class="p">,</span><span class="s2">&quot;=&quot;</span><span class="p">,</span><span class="n">num_nodes</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Arcs in Layer&quot;</span><span class="p">,</span> <span class="n">layer_id</span><span class="p">,</span><span class="s2">&quot;=&quot;</span><span class="p">,</span><span class="n">num_arcs</span><span class="p">)</span>
        

<span class="k">def</span> <span class="nf">debug</span><span class="p">():</span>
    <span class="c1">#N=load_infrastructure_data(BASE_DIR=&quot;../../../iINDP&quot;,sim_number=250,magnitude=6)</span>
    <span class="n">N</span><span class="o">=</span><span class="n">load_infrastructure_data</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="o">=</span><span class="s2">&quot;../data/INDP_7-20-2015/&quot;</span><span class="p">,</span><span class="n">sim_number</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span><span class="n">magnitude</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">external_interdependency_dir</span><span class="o">=</span><span class="s2">&quot;../data/INDP_4-12-2016&quot;</span><span class="p">)</span>
    <span class="n">N</span><span class="o">.</span><span class="n">to_csv</span><span class="p">()</span>
    <span class="c1">#N=load_infrastructure_data(BASE_DIR=&quot;../../../iINDP&quot;,sim_number=250,magnitude=9)</span>
    <span class="n">count_interdependencies</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">count_nodes</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">count_nodes</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="c1">#count_supply(N,1)</span>
    <span class="c1">#count_supply(N,2)</span>
    <span class="c1">#count_supply(N,3)</span>
<span class="c1">#debug()</span>

<span class="k">def</span> <span class="nf">read_failure_scenario</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="o">=</span><span class="s2">&quot;../data/INDP_7-20-2015/&quot;</span><span class="p">,</span><span class="n">magnitude</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">sim_number</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">sim_number</span> <span class="o">==</span> <span class="s2">&quot;INF&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">sim_number</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="s1">&#39;q&#39;</span><span class="p">,</span><span class="s1">&#39;Mp&#39;</span><span class="p">,</span><span class="s1">&#39;Mm&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="s1">&#39;gamma&#39;</span><span class="p">,</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span><span class="s1">&#39;beta&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;n&#39;</span><span class="p">]</span>
        <span class="n">entry_regex</span><span class="o">=</span>         <span class="sa">r</span><span class="s2">&quot;\(\s*(?P&lt;tuple&gt;(\d+\s*,\s*)*\d)\s*\)\s*(?P&lt;val&gt;-?\d+)&quot;</span>
        <span class="n">recovery_entry_regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\(\s*(?P&lt;tuple&gt;(\d+\s+)*\d)\s*\)\s*(?P&lt;val&gt;\d+)&quot;</span>
        <span class="n">var_regex</span><span class="o">=</span>   <span class="sa">r</span><span class="s2">&quot;(?P&lt;varname&gt;\D+):\s*\[(?P&lt;entries&gt;[^\]]*)\]&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">var_regex</span><span class="p">,</span><span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">BASE_DIR</span><span class="o">+</span><span class="s2">&quot;/Failure and recovery scenarios/recoveryM&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">magnitude</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;v3.txt&quot;</span>
        <span class="nb">vars</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="c1">#print &quot;Opened&quot;,file,&quot;.&quot;                                                                                                      xs                              </span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">vars_strings</span><span class="o">=</span><span class="p">{}</span>
            <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">pattern</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="n">vars_strings</span><span class="p">[</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;varname&#39;</span><span class="p">))]</span><span class="o">=</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;entries&#39;</span><span class="p">))</span>
            <span class="c1">#print &quot;Varstrings=&quot;,vars_strings.keys()                                                                                                            </span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vars_strings</span><span class="p">:</span>
                <span class="n">entry_string</span><span class="o">=</span><span class="n">vars_strings</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
                <span class="n">entry_pattern</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">entry_regex</span><span class="p">,</span><span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
                <span class="n">is_match</span><span class="o">=</span><span class="kc">False</span>
                <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">entry_pattern</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">entry_string</span><span class="p">):</span>
                    <span class="n">is_match</span><span class="o">=</span><span class="kc">True</span>
                    <span class="n">tuple_string</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;tuple&#39;</span><span class="p">)</span>
                    <span class="n">val_string</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;val&#39;</span><span class="p">)</span>
                    <span class="n">tuple_string</span><span class="o">=</span><span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">tuple_string</span><span class="p">,</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                    <span class="n">tuple_string</span><span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tuple_string</span><span class="p">]</span>
                    <span class="n">val_string</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">val_string</span><span class="p">))</span>
                    <span class="c1">#print v,&quot;:&quot;,tuple_string,&quot;=&gt;&quot;,val_string                                                                                                         </span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">:</span>
                        <span class="nb">vars</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
                    <span class="nb">vars</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tuple_string</span><span class="p">,</span><span class="n">val_string</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_match</span><span class="p">:</span>
                    <span class="n">recovery_pattern</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">recovery_entry_regex</span><span class="p">,</span><span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">recovery_pattern</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">entry_string</span><span class="p">):</span>
                        <span class="n">is_match</span><span class="o">=</span><span class="kc">True</span>
                        <span class="n">tuple_string</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;tuple&#39;</span><span class="p">)</span>
                        <span class="n">val_string</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;val&#39;</span><span class="p">)</span>
                        <span class="n">tuple_string</span><span class="o">=</span><span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">tuple_string</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                        <span class="n">tuple_string</span><span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tuple_string</span><span class="p">]</span>
                        <span class="n">val_string</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">val_string</span><span class="p">))</span>
                        <span class="c1">#print v,&quot;:&quot;,tuple_string,&quot;=&gt;&quot;,val_string</span>
                        <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">:</span>
                            <span class="nb">vars</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
                        <span class="nb">vars</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tuple_string</span><span class="p">,</span><span class="n">val_string</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">vars</span>

<span class="k">def</span> <span class="nf">load_synthetic_network</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="o">=</span><span class="s2">&quot;../data/Generated_Network_Dataset_v3&quot;</span><span class="p">,</span><span class="n">topology</span><span class="o">=</span><span class="s1">&#39;Random&#39;</span><span class="p">,</span><span class="n">config</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">sample</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">cost_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Initiallize Damage...&quot;</span><span class="p">)</span>
    <span class="n">net_dir</span> <span class="o">=</span> <span class="n">BASE_DIR</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">topology</span><span class="o">+</span><span class="s1">&#39;Networks</span><span class="se">\\</span><span class="s1">&#39;</span>
    <span class="n">topo_initial</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Random&#39;</span><span class="p">:</span><span class="s1">&#39;RN&#39;</span><span class="p">,</span><span class="s1">&#39;ScaleFree&#39;</span><span class="p">:</span><span class="s1">&#39;SFN&#39;</span><span class="p">,</span><span class="s1">&#39;Grid&#39;</span><span class="p">:</span><span class="s1">&#39;GN&#39;</span><span class="p">}</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">net_dir</span><span class="o">+</span><span class="s1">&#39;List_of_Configurations.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">config_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">config_param</span> <span class="o">=</span> <span class="n">config_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">config</span><span class="p">]</span>
    <span class="n">noLayers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config_param</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39; No. Layers&#39;</span><span class="p">])</span>    
    <span class="n">noResource</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config_param</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39; Resource Cap&#39;</span><span class="p">])</span>  
    
    <span class="n">file_dir</span> <span class="o">=</span> <span class="n">net_dir</span><span class="o">+</span><span class="n">topo_initial</span><span class="p">[</span><span class="n">topology</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;Config_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Sample_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span>
    <span class="n">G</span><span class="o">=</span><span class="n">InfrastructureNetwork</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
    <span class="n">global_index</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">file_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">file_dir</span><span class="p">,</span> <span class="n">f</span><span class="p">))]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">noLayers</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">file</span><span class="o">==</span><span class="s1">&#39;N&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_Nodes.txt&#39;</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_dir</span><span class="o">+</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="c1">#                print &quot;Opened&quot;,file,&quot;.&quot;</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>                        
                        <span class="n">n</span><span class="o">=</span><span class="n">InfrastructureNode</span><span class="p">(</span><span class="n">global_index</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
                        <span class="c1">#print &quot;Adding node&quot;,node[0][0],&quot;in layer&quot;,node[0][1],&quot;.&quot;</span>
                        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">((</span><span class="n">n</span><span class="o">.</span><span class="n">local_id</span><span class="p">,</span><span class="n">n</span><span class="o">.</span><span class="n">net_id</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;inf_data&#39;</span><span class="p">:</span><span class="n">n</span><span class="p">})</span>
                        <span class="n">global_index</span><span class="o">+=</span><span class="mi">1</span>                    
                        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[(</span><span class="n">n</span><span class="o">.</span><span class="n">local_id</span><span class="p">,</span><span class="n">n</span><span class="o">.</span><span class="n">net_id</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reconstruction_cost</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">7</span><span class="p">])</span><span class="o">*</span><span class="n">cost_scale</span>
                        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[(</span><span class="n">n</span><span class="o">.</span><span class="n">local_id</span><span class="p">,</span><span class="n">n</span><span class="o">.</span><span class="n">net_id</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">oversupply_penalty</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">5</span><span class="p">])</span><span class="o">*</span><span class="n">cost_scale</span>
                        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[(</span><span class="n">n</span><span class="o">.</span><span class="n">local_id</span><span class="p">,</span><span class="n">n</span><span class="o">.</span><span class="n">net_id</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">undersupply_penalty</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">6</span><span class="p">])</span><span class="o">*</span><span class="n">cost_scale</span>
                        <span class="c1"># Assume only one kind of resource for now and one resource for each repaired element.</span>
                        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[(</span><span class="n">n</span><span class="o">.</span><span class="n">local_id</span><span class="p">,</span><span class="n">n</span><span class="o">.</span><span class="n">net_id</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resource_usage</span><span class="o">=</span><span class="mi">1</span>
                        <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[(</span><span class="n">n</span><span class="o">.</span><span class="n">local_id</span><span class="p">,</span><span class="n">n</span><span class="o">.</span><span class="n">net_id</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">demand</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">file</span><span class="o">==</span><span class="s1">&#39;N&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_Arcs.txt&#39;</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_dir</span><span class="o">+</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="c1">#                print &quot;Opened&quot;,file,&quot;.&quot;</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span> 
                        <span class="k">for</span> <span class="n">duplicate</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">duplicate</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                                <span class="n">a</span><span class="o">=</span><span class="n">InfrastructureArc</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span><span class="n">k</span><span class="p">)</span> 
                            <span class="k">elif</span> <span class="n">duplicate</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                                <span class="n">a</span><span class="o">=</span><span class="n">InfrastructureArc</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span><span class="n">k</span><span class="p">)</span> 
                            <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">source</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">layer</span><span class="p">),(</span><span class="n">a</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">layer</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;inf_data&#39;</span><span class="p">:</span><span class="n">a</span><span class="p">})</span>
                            <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="n">a</span><span class="o">.</span><span class="n">source</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">layer</span><span class="p">)][(</span><span class="n">a</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">layer</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flow_cost</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="n">cost_scale</span>
                            <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="n">a</span><span class="o">.</span><span class="n">source</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">layer</span><span class="p">)][(</span><span class="n">a</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">layer</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reconstruction_cost</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span><span class="o">*</span><span class="n">cost_scale</span>
                            <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="n">a</span><span class="o">.</span><span class="n">source</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">layer</span><span class="p">)][(</span><span class="n">a</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">layer</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">capacity</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                            <span class="c1"># Assume only one kind of resource for now and one resource for each repaired element.</span>
                            <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="n">a</span><span class="o">.</span><span class="n">source</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">layer</span><span class="p">)][(</span><span class="n">a</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">layer</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resource_usage</span><span class="o">=</span><span class="mi">1</span>   
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">noLayers</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">kt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">noLayers</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">k</span><span class="o">!=</span><span class="n">kt</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">file</span><span class="o">==</span><span class="s1">&#39;Interdependent_Arcs_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kt</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.txt&#39;</span><span class="p">:</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_dir</span><span class="o">+</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="c1">#                print &quot;Opened&quot;,file,&quot;.&quot;</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>                                      
                                    <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                                    <span class="n">net_i</span> <span class="o">=</span> <span class="n">k</span>
                                    <span class="n">j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                                    <span class="n">net_j</span> <span class="o">=</span> <span class="n">kt</span>
                                    <span class="n">a</span><span class="o">=</span><span class="n">InfrastructureInterdepArc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">net_i</span><span class="p">,</span><span class="n">net_j</span><span class="p">,</span><span class="n">gamma</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
                                    <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">source</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">source_layer</span><span class="p">),(</span><span class="n">a</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">dest_layer</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;inf_data&#39;</span><span class="p">:</span><span class="n">a</span><span class="p">})</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Empty file: &#39;</span><span class="o">+</span> <span class="n">file</span><span class="p">)</span>
<span class="c1"># add subspace data #!!!</span>
<span class="c1">#for v in data.iterrows():</span>
<span class="c1">#    if fname==&#39;beta&#39;:</span>
<span class="c1">#        net = netNames[v[1][&#39;Network&#39;]]</span>
<span class="c1">#        G.G[(int(v[1][&#39;Start Node&#39;]),net)][(int(v[1][&#39;End Node&#39;]),net)][&#39;data&#39;][&#39;inf_data&#39;].space=int(int(v[1][&#39;Subspace&#39;]))</span>
<span class="c1">#        G.G[(int(v[1][&#39;End Node&#39;]),net)][(int(v[1][&#39;Start Node&#39;]),net)][&#39;data&#39;][&#39;inf_data&#39;].space=int(int(v[1][&#39;Subspace&#39;]))</span>
<span class="c1">#    if fname==&#39;alpha&#39;:</span>
<span class="c1">#        net = netNames[v[1][&#39;Network&#39;]]</span>
<span class="c1">#        G.G.node[(int(v[1][&#39;ID&#39;]),net)][&#39;data&#39;][&#39;inf_data&#39;].space=int(int(v[1][&#39;Subspace&#39;]))</span>
<span class="c1">#    if fname==&#39;g&#39;:</span>
<span class="c1">#        G.S.append(InfrastructureSpace(int(v[1][&#39;Subspace_ID&#39;]),float(v[1][&#39;g&#39;])))  </span>

    <span class="k">return</span> <span class="n">G</span><span class="p">,</span><span class="n">noResource</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">noLayers</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">add_synthetic_failure_scenario</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">DAM_DIR</span><span class="o">=</span><span class="s2">&quot;../data/Generated_Network_Dataset_v3&quot;</span><span class="p">,</span><span class="n">topology</span><span class="o">=</span><span class="s1">&#39;Random&#39;</span><span class="p">,</span><span class="n">config</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">sample</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">net_dir</span> <span class="o">=</span> <span class="n">DAM_DIR</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">topology</span><span class="o">+</span><span class="s1">&#39;Networks</span><span class="se">\\</span><span class="s1">&#39;</span>
    <span class="n">topo_initial</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Random&#39;</span><span class="p">:</span><span class="s1">&#39;RN&#39;</span><span class="p">,</span><span class="s1">&#39;ScaleFree&#39;</span><span class="p">:</span><span class="s1">&#39;SFN&#39;</span><span class="p">,</span><span class="s1">&#39;Grid&#39;</span><span class="p">:</span><span class="s1">&#39;GN&#39;</span><span class="p">}</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">net_dir</span><span class="o">+</span><span class="s1">&#39;List_of_Configurations.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">config_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">config_param</span> <span class="o">=</span> <span class="n">config_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">config</span><span class="p">]</span> 
    <span class="n">noLayers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config_param</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39; No. Layers&#39;</span><span class="p">])</span> 
    <span class="n">noResource</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config_param</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39; Resource Cap&#39;</span><span class="p">])</span>  
    <span class="n">file_dir</span> <span class="o">=</span> <span class="n">net_dir</span><span class="o">+</span><span class="n">topo_initial</span><span class="p">[</span><span class="n">topology</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;Config_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Sample_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">file_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">file_dir</span><span class="p">,</span> <span class="n">f</span><span class="p">))]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">noLayers</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">file</span><span class="o">==</span><span class="s1">&#39;N&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_Damaged_Nodes.txt&#39;</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_dir</span><span class="o">+</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>    
                            <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">k</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="mf">0.0</span>
                            <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">k</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">repaired</span><span class="o">=</span><span class="mf">0.0</span>
<span class="c1">#                            print &quot;Node (&quot;,`int(v[1][0])`+&quot;,&quot;+`k`+&quot;) broken.&quot;</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Empty file: &#39;</span><span class="o">+</span> <span class="n">file</span><span class="p">)</span>
                                
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">file</span><span class="o">==</span><span class="s1">&#39;N&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_Damaged_Arcs.txt&#39;</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_dir</span><span class="o">+</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>   
                            <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">k</span><span class="p">)][(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">k</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="mf">0.0</span>
                            <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">k</span><span class="p">)][(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">k</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">repaired</span><span class="o">=</span><span class="mf">0.0</span>
<span class="c1">#                            print &quot;Arc ((&quot;,`int(a[1][0])`+&quot;,&quot;+`k`+&quot;),(&quot;+`int(a[1][1])`+&quot;,&quot;+`k`+&quot;)) broken.&quot;</span>
                            
                            <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">k</span><span class="p">)][(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">k</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span><span class="o">=</span><span class="mf">0.0</span>
                            <span class="n">G</span><span class="o">.</span><span class="n">G</span><span class="p">[(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">k</span><span class="p">)][(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">k</span><span class="p">)][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">repaired</span><span class="o">=</span><span class="mf">0.0</span>
<span class="c1">#                            print &quot;Arc ((&quot;,`int(a[1][1])`+&quot;,&quot;+`k`+&quot;),(&quot;+`int(a[1][0])`+&quot;,&quot;+`k`+&quot;)) broken.&quot;</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Empty file: &#39;</span><span class="o">+</span> <span class="n">file</span><span class="p">)</span>    
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Hesam Talebiyan

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>